<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>.NET and Node.JS - Performance Comparison (Updated) | Salman Quazi</title>
<meta property="og:title" content=".NET and Node.JS - Performance Comparison (Updated) | Salman Quazi"><meta name=twitter:title content=".NET and Node.JS - Performance Comparison (Updated) | Salman Quazi"><meta itemprop=name content=".NET and Node.JS - Performance Comparison (Updated) | Salman Quazi"><meta name=application-name content=".NET and Node.JS - Performance Comparison (Updated) | Salman Quazi"><meta property="og:site_name" content="Salman Quazi"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:locale" content="en-us"><meta name=language content="en-us"><link rel=alternate hreflang=en href=https://www.salmanq.com/en/blog/net-and-node-js-performance-comparison/ title><meta name=generator content="Hugo 0.134.2"><meta property="og:url" content="https://www.salmanq.com/en/blog/net-and-node-js-performance-comparison/"><meta property="og:site_name" content="Salman Quazi"><meta property="og:title" content=".NET and Node.JS - Performance Comparison (Updated)"><meta property="og:description" content="Update (3/31/2013 - 11:41 PM PST):
This article has been updated! As most readers have commented the node.js async package is not asynchronous, which is what the original article was based on. I made an assumption I should not have. I have since rerun the tests taking this into account, as well as some of the changes recommended by Guillaume Lecomte. I have decided to update this existing post so that there’s no confusion in the future with the data. Thank you everyone for all the comments, posts and keeping me sane."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="en"><meta property="article:published_time" content="2013-03-26T08:57:39+00:00"><meta property="article:modified_time" content="2013-03-26T08:57:39+00:00"><meta property="article:tag" content="Uncategorized"><meta name=twitter:card content="summary"><meta name=twitter:title content=".NET and Node.JS - Performance Comparison (Updated)"><meta name=twitter:description content="Update (3/31/2013 - 11:41 PM PST):
This article has been updated! As most readers have commented the node.js async package is not asynchronous, which is what the original article was based on. I made an assumption I should not have. I have since rerun the tests taking this into account, as well as some of the changes recommended by Guillaume Lecomte. I have decided to update this existing post so that there’s no confusion in the future with the data. Thank you everyone for all the comments, posts and keeping me sane."><link rel=canonical href=https://www.salmanq.com/en/blog/net-and-node-js-performance-comparison/><link href=/style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://www.salmanq.com/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")}</script></head><body data-theme=dark class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://www.salmanq.com/ class=logo><svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title/><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class=menu-link href=/blog/>Blog</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>.NET and Node.JS - Performance Comparison (Updated)</h1><div class=post-meta><time datetime=2013-03-26T08:57:39+00:00 itemprop=datePublished>Mar 26, 2013</time></div></header><div class=page-content><p><strong>Update (3/31/2013 - 11:41 PM PST):</strong></p><p>This article has been updated! As most readers have commented the node.js async package is not asynchronous, which is what the original article was based on. I made an assumption I should not have. I have since rerun the tests taking this into account, as well as some of the changes recommended by <a href=http://guillaume86.calepin.co/dotnet-vs-nodejs-performance.html>Guillaume Lecomte</a>. I have decided to update this existing post so that there&rsquo;s no confusion in the future with the data. Thank you everyone for all the comments, posts and keeping me sane.</p><p><strong>Update (3/29/2013 - 3:43 PM PST):</strong></p><p>There&rsquo;s been a lot of valid comments around the use of the async NPM package for node.js which are valid. I will take them into account and re-run these tests. If you talk to any silicon valley startup today chances are you will hear about <a href=http://nodejs.org/>node.js</a>. One of the key reasons most argue is that node.js is fast, scalable because of forced non-blocking IO, and it&rsquo;s efficient use of a single threaded model. I personally love JavaScript, so being able to use JavaScript on the server side seemed like a key gain. But I was never really sold into the notion that node.js is supremely fast because there aren&rsquo;t any context switches and thread synchronizations. We all know these practices should be avoided at all costs in any multi-threaded program, but to give it all away seemed like an extreme. But if that meant consistently higher performance, then sure, that would make sense. So I wanted to test this theory. I wanted to find out exactly how fast node.js was compared to .NET - as empirically as possible. So I wanted to come up with a problem that involved IO (ideally not involving a database), and some computation. And I wanted to do this under load, so that I could see how each system behaves under pressure. I came up with the following problem: I have approximately 200 files, each containing somewhere between 10 to 30 thousand random decimals. Each request to the server would contain a number such as: /1 or /120, the service would then open the corresponding file, read the contents, and sort them in memory and output the median value. That&rsquo;s it. Our goal is to reach a maximum of 200 simultaneous requests, so the idea is that each request would have a corresponding file without ever overlapping. I also wanted to align the two platforms (.NET and Node.js). For instance, I didn&rsquo;t want to host the .NET service on IIS because it seemed unfair to pay the cost of all the things IIS comes with (caching, routing, performance counters), only to never use them. I also avoided the entire ASP.NET pipeline, including MVC for the same reasons, they all come with features, which we don&rsquo;t care about in this case. Okay, so both .NET and Node.JS will create a basic HTTP listener. What about client? The plan here is to create a simple .NET console app that drives load to the service. While the client is written in .NET, the key point here is that we test both .NET and Node.JS services using the same client. So at a minimum how the client is written is a negligible problem. Before we delve into the details, let&rsquo;s look the graph that shows us the results: <img src=/2013/03/performance-comparison-net-nodejs.png alt=".NET and Node.JS - Performance Comparison"></p><p>On an average Node.js wins hands down. Even though there are few spikes that could be attributed to various disk related anomalies, as some of the readers have eluded to. I also want to clarify that if you look at the graph carefully you start to see that the two lines start to intersect towards the end of the test run, while that might start to give you the impression that overtime the performance for .NET and node.js converge the reality is .NET starts to suffer even more over time. Let&rsquo;s look at each aspect of this test more carefully. We&rsquo;ll start with the client, the client uses a <a href=http://msdn.microsoft.com/en-us/library/system.net.http.httpclient.aspx>HttpClient</a> to drive requests to the service. The response times are maintained on the client side so that there aren&rsquo;t any drastic implementation difference on the service that could impact our numbers. Notice that I avoided doing any Console.Write (which blocks) until the very end.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl> <span class=kd>public</span> <span class=k>void</span> <span class=n>Start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Task</span><span class=p>[]</span> <span class=n>tasks</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Task</span><span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=n>tasks</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=n>tasks</span><span class=p>;</span> <span class=p>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>tasks</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=p>=</span> <span class=k>this</span><span class=p>.</span><span class=n>Perform</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Task</span><span class=p>.</span><span class=n>WaitAll</span><span class=p>(</span><span class=n>tasks</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>result</span><span class=p>.</span><span class=n>ToList</span><span class=p>().</span><span class=n>ForEach</span><span class=p>(</span><span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>Perform</span><span class=p>(</span><span class=kt>int</span> <span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>url</span> <span class=p>=</span> <span class=n>String</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;{0}{1}&#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>baseUrl</span><span class=p>,</span> <span class=n>state</span><span class=p>.</span><span class=n>ToString</span><span class=p>().</span><span class=n>PadLeft</span><span class=p>(</span><span class=m>3</span><span class=p>,</span> <span class=sc>&#39;0&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>HttpClient</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Stopwatch</span> <span class=n>timer</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Stopwatch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>timer</span><span class=p>.</span><span class=n>Start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>string</span> <span class=n>result</span> <span class=p>=</span> <span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>GetStringAsync</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>timer</span><span class=p>.</span><span class=n>Stop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=n>result</span><span class=p>.</span><span class=n>Enqueue</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;{0,4}\t{1,5}\t{2}&#34;</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>timer</span><span class=p>.</span><span class=n>ElapsedMilliseconds</span><span class=p>,</span> <span class=n>result</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><p>With that client, we can start looking at the service. First we&rsquo;ll start with the node.js implementation. One of the beauties of node.js is it&rsquo;s succinct syntax. With less than 40 lines of code we are able to fork processes based on the number of CPU cores and share the CPU-bound tasks amongst them.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>cluster</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;cluster&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>numCPUs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;os&#39;</span><span class=p>).</span><span class=nx>cpus</span><span class=p>().</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>cluster</span><span class=p>.</span><span class=nx>isMaster</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Fork workers.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numCPUs</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>cluster</span><span class=p>.</span><span class=nx>fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>cluster</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;exit&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>worker</span><span class=p>,</span> <span class=nx>code</span><span class=p>,</span> <span class=nx>signal</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;worker &#39;</span> <span class=o>+</span> <span class=nx>worker</span><span class=p>.</span><span class=nx>process</span><span class=p>.</span><span class=nx>pid</span> <span class=o>+</span> <span class=s1>&#39; died&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>request</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>file</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>request</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>substring</span><span class=p>(</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=nx>file</span> <span class=o>=</span> <span class=nx>file</span> <span class=o>%</span> <span class=mi>200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nx>file</span> <span class=o>=</span> <span class=nb>String</span><span class=p>(</span><span class=s2>&#34;000&#34;</span> <span class=o>+</span> <span class=nx>file</span><span class=p>).</span><span class=nx>slice</span><span class=p>(</span><span class=o>-</span><span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// read the file
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;../data/input&#39;</span><span class=o>+</span><span class=nx>file</span><span class=o>+</span><span class=s1>&#39;.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;ascii&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>response</span><span class=p>.</span><span class=nx>writeHead</span><span class=p>(</span><span class=mi>400</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span><span class=s1>&#39;text/plain&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>				<span class=nx>response</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=kd>var</span> <span class=nx>results</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>toString</span><span class=p>().</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;\r\n&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>				<span class=nx>results</span><span class=p>.</span><span class=nx>sort</span><span class=p>();</span>
</span></span><span class=line><span class=cl>				<span class=nx>response</span><span class=p>.</span><span class=nx>writeHead</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;text/plain&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl>				<span class=nx>response</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;input&#39;</span><span class=o>+</span><span class=nx>file</span><span class=o>+</span><span class=s1>&#39;.txt\t&#39;</span> <span class=o>+</span> <span class=nx>results</span><span class=p>[(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>results</span><span class=p>.</span><span class=nx>length</span><span class=o>/</span><span class=mi>2</span><span class=p>))]);</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>});</span>
</span></span><span class=line><span class=cl>	<span class=p>}).</span><span class=nx>listen</span><span class=p>(</span><span class=mi>8080</span><span class=p>,</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Server running at http://127.0.0.1:8080/&#39;</span><span class=p>)</span> 
</span></span></code></pre></div><p>And lastly, let&rsquo;s look at the .NET service implementation. Needless to say we are using .NET 4.5, with all the <a href=http://blogs.msdn.com/b/toub/>glories of async/await</a>. As I mentioned earlier, I wanted to compare purely .NET without IIS or ASP.NET, so I started off with <a href=http://msdn.microsoft.com/en-us/library/system.net.httplistener.aspx>a simple HTTP listener</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>public</span> <span class=kd>async</span> <span class=n>Task</span> <span class=n>Start</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>context</span> <span class=p>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=n>listener</span><span class=p>.</span><span class=n>GetContextAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=n>ProcessRequest</span><span class=p>(</span><span class=n>context</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><p>With that I am able to start processing each request, as requests come in I read the file stream asynchronously so I am not blocking my Threadpool thread, and perform the in-memory sort which is a simple Task that wraps the Array.Sort. With .NET I could have severely improved performance in this area by using parallel sorting algorithms which come right of the <a href=http://msdn.microsoft.com/en-us/library/dd460717.aspx>parallel extensions</a>, but I choose not to because that really isn&rsquo;t the point of this test.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=kd>private</span> <span class=kd>async</span> <span class=k>void</span> <span class=n>ProcessRequest</span><span class=p>(</span><span class=n>HttpListenerContext</span> <span class=n>context</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>filename</span> <span class=p>=</span> <span class=k>this</span><span class=p>.</span><span class=n>GetFileFromUrl</span><span class=p>(</span><span class=n>context</span><span class=p>.</span><span class=n>Request</span><span class=p>.</span><span class=n>Url</span><span class=p>.</span><span class=n>PathAndQuery</span><span class=p>.</span><span class=n>Substring</span><span class=p>(</span><span class=m>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=kt>string</span> <span class=n>rawData</span> <span class=p>=</span> <span class=kt>string</span><span class=p>.</span><span class=n>Empty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>using</span> <span class=p>(</span><span class=n>StreamReader</span> <span class=n>reader</span> <span class=p>=</span> <span class=k>new</span> <span class=n>StreamReader</span><span class=p>(</span><span class=n>Path</span><span class=p>.</span><span class=n>Combine</span><span class=p>(</span><span class=n>dataDirectory</span><span class=p>,</span> <span class=n>filename</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>rawData</span> <span class=p>=</span> <span class=k>await</span> <span class=n>reader</span><span class=p>.</span><span class=n>ReadToEndAsync</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>sorted</span> <span class=p>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=n>SortAsync</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>rawData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>response</span> <span class=p>=</span> <span class=n>encoding</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=n>Format</span><span class=p>(</span><span class=s>&#34;{0}\t{1}&#34;</span><span class=p>,</span> <span class=n>filename</span><span class=p>,</span> <span class=n>sorted</span><span class=p>[</span><span class=n>sorted</span><span class=p>.</span><span class=n>Length</span> <span class=p>/</span> <span class=m>2</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=n>context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>OutputStream</span><span class=p>.</span><span class=n>WriteAsync</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=n>response</span><span class=p>.</span><span class=n>Length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>StatusCode</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>HttpStatusCode</span><span class=p>.</span><span class=n>OK</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>StatusCode</span> <span class=p>=</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>HttpStatusCode</span><span class=p>.</span><span class=n>BadRequest</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=n>Message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>context</span><span class=p>.</span><span class=n>Response</span><span class=p>.</span><span class=n>Close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kd>async</span> <span class=n>Task</span><span class=p>&lt;</span><span class=kt>string</span><span class=p>[]&gt;</span> <span class=n>SortAsync</span><span class=p>(</span><span class=n>HttpListenerContext</span> <span class=n>context</span><span class=p>,</span> <span class=kt>string</span> <span class=n>rawData</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Factory</span><span class=p>.</span><span class=n>StartNew</span><span class=p>(()</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>var</span> <span class=n>array</span> <span class=p>=</span> <span class=n>rawData</span><span class=p>.</span><span class=n>Split</span><span class=p>(</span><span class=k>new</span> <span class=kt>string</span><span class=p>[]</span> <span class=p>{</span> <span class=s>&#34;\r\n&#34;</span> <span class=p>},</span> <span class=n>StringSplitOptions</span><span class=p>.</span><span class=n>RemoveEmptyEntries</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Array</span><span class=p>.</span><span class=n>Sort</span><span class=p>(</span><span class=n>array</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>array</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><p>You can <a href=/2013/03/nodenetperf.zip>download the entire source code</a>, this zip file includes both client, and service sources for both .NET and node.js. It also includes a tool to generate the random number files, so that you can run the tests on your local machine. You will also find the raw numbers in the zip file. I hope this was useful to you all as you&rsquo;re deciding to choose the next framework to build your services on. For most startups the key pivot point is performance, scalability over anything else and node.js clearly shines as we&rsquo;ve shown today. Also, please remember some of the comments below are based on the original article which was using the <a href=https://github.com/caolan/async>async</a> NPM package. This article has since been updated with the corrected information.</p></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/splusq target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://www.twitter.com/splusq target=_blank rel="noopener noreferrer me" title=Twitter><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a><a href=https://www.linkedin.com/in/salmanquazi/ target=_blank rel="noopener noreferrer me" title=Linkedin><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2024 Salman Quazi.</small></footer><script src=https://www.salmanq.com/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script></body></html>