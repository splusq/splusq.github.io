<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.120.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>JavaScript Performance - Part II &#183; Salman Quazi</title>
<meta name=description content><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/poole.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/syntax.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><style type=text/css>.sidebar-about h1{font-size:1.95rem;font-weight:400}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")</script></head><body class=theme-base-08><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://www.salmanq.com/><h1>Salman Quazi</h1></a><p class=lead>Engineering Manager for Microsoft Azure Cognitive Services in Mountain View, CA.</p></div><nav><ul class=sidebar-nav><li><a href=https://www.salmanq.com/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=https://github.com/splusq/>Github</a></li><li><a href=https://www.linkedin.com/in/salmanquazi/>LinkedIn</a></li><li><a href=https://www.twitter.com/splusq>Twitter</a></li></ul></nav><p>Opinions are my own.</p></div></aside><main class="content container"><div class=post><h1>JavaScript Performance - Part II</h1><time datetime=2004-11-02T02:58:36Z class=post-date>Tue, Nov 2, 2004</time><p><em>As I <a href=/blog/javascript-performance-part-i>discussed last week</a> setInterval in general gives better performance compared to setTimeout.</em></p><p>Today I will discuss how in order to improve performance, one thread can be used to run multiple animations. Multiple animations come up in several scenarios. For instance, if you have a menu that does some animation onmouseover then although not clear at first this menu system could be running multiple animations at the same time. For example, let&rsquo;s say the animation takes 2 secs to run. Then in this 2 second time frame if the user highlights another menu item then the browser is actually running to threads one for each menu item. This is can bring down the performance of the system quite heavily.</p><p>Every animation can be broken down into discrete states &ndash; where each state changes with time. For instance, a animation of a bicycle moving in a two-dimensional space can be broken down into it&rsquo;s x coordinates everytime the thread is run the x-coordinate of the bicycle is updated and the bicycle is moved. The same can be done with menu items.</p><p>Notice that onmouseover and onmouseout the background of the menu transitions in and transitions out respectively. Had I used one thread for each of those menu items and if the user quickly went over several menu items quickly then the performance would greatly sacrificed.</p><p>In the case of the menu above there is only one state to maintain: the background color information for each of the menu item. On mouseover the setTimeout is started (only <strong>once</strong> no matter how many mouseover occurs) and a primary function (sometimes also known as a runner) runs through all the menu items and decrements or increments the color of the background (decrements if mouseout, increments if mouseover). That&rsquo;s it!</p><p>Here&rsquo;s a sample code illustrating that idea:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>MenuObjects</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Array();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>TimerObject</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>MenuEffectRun</span>() {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>remaining</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span>(<span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>menuObjects</span>.<span style=color:#a6e22e>length</span>;<span style=color:#f92672>++</span><span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>typeof</span>(<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>i</span>])<span style=color:#f92672>!=</span><span style=color:#e6db74>&#34;undefined&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>i</span>][<span style=color:#ae81ff>0</span>]) <span style=color:#a6e22e>remaining</span><span style=color:#f92672>+=</span><span style=color:#a6e22e>MenuGlow</span>(<span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>remaining</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>TimerObject</span>) {
</span></span><span style=display:flex><span>		<span style=color:#75715e>//change for non-IE browsers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>//TimerObject = setTimeout(&#34;MenuEffectRun()&#34;,10);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>TimerObject</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>setInterval</span>(<span style=color:#e6db74>&#34;MenuEffectRun()&#34;</span>,<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>remaining</span>) {
</span></span><span style=display:flex><span>		<span style=color:#75715e>//change for non-IE browsers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>//clearTimeout(TimerObject);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		window.<span style=color:#a6e22e>clearInterval</span>(<span style=color:#a6e22e>TimerObject</span>);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>TimerObject</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>MenuHighlight</span>(<span style=color:#a6e22e>Table</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>Table</span>.<span style=color:#a6e22e>id</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Table</span>.<span style=color:#a6e22e>className</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;menuhover&#39;</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>typeof</span>(<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>])<span style=color:#f92672>==</span><span style=color:#e6db74>&#34;undefined&#34;</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Array(<span style=color:#a6e22e>Table</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>30</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>;
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>][<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>TimerObject</span>) <span style=color:#a6e22e>MenuEffectRun</span>();		
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>MenuNormal</span>(<span style=color:#a6e22e>Table</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>Table</span>.<span style=color:#a6e22e>id</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>	<span style=color:#75715e>//Table.className=&#39;menu&#39;;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>id</span>][<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>TimerObject</span>) <span style=color:#a6e22e>MenuEffectRun</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>MenuGlow</span>(<span style=color:#a6e22e>index</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>start</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>index</span>][<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>step</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>index</span>][<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>index</span>][<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fstate</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span><span style=color:#f92672>^</span><span style=color:#ae81ff>1</span>); <span style=color:#75715e>// alternate transformation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>start</span><span style=color:#f92672>&lt;=</span><span style=color:#a6e22e>step</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>index</span>][<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>background</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;rgb(&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>			Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>BackgroundTransform</span>[<span style=color:#a6e22e>state</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> ((<span style=color:#a6e22e>step</span><span style=color:#f92672>-</span><span style=color:#a6e22e>start</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>BackgroundTransform</span>[<span style=color:#a6e22e>fstate</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> (<span style=color:#a6e22e>start</span><span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>)) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;,&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>			Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>BackgroundTransform</span>[<span style=color:#a6e22e>state</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> ((<span style=color:#a6e22e>step</span><span style=color:#f92672>-</span><span style=color:#a6e22e>start</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>BackgroundTransform</span>[<span style=color:#a6e22e>fstate</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> (<span style=color:#a6e22e>start</span><span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>)) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;,&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>			Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>BackgroundTransform</span>[<span style=color:#a6e22e>state</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> ((<span style=color:#a6e22e>step</span><span style=color:#f92672>-</span><span style=color:#a6e22e>start</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>BackgroundTransform</span>[<span style=color:#a6e22e>fstate</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> (<span style=color:#a6e22e>start</span><span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>)) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>;
</span></span><span style=display:flex><span>			
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>index</span>][<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>color</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;rgb(&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>			Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>FontTransform</span>[<span style=color:#a6e22e>state</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> ((<span style=color:#a6e22e>step</span><span style=color:#f92672>-</span><span style=color:#a6e22e>start</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>FontTransform</span>[<span style=color:#a6e22e>fstate</span>][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> (<span style=color:#a6e22e>start</span><span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>)) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;,&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>			Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>FontTransform</span>[<span style=color:#a6e22e>state</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> ((<span style=color:#a6e22e>step</span><span style=color:#f92672>-</span><span style=color:#a6e22e>start</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>FontTransform</span>[<span style=color:#a6e22e>fstate</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> (<span style=color:#a6e22e>start</span><span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>)) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;,&#34;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>			Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>FontTransform</span>[<span style=color:#a6e22e>state</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> ((<span style=color:#a6e22e>step</span><span style=color:#f92672>-</span><span style=color:#a6e22e>start</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>FontTransform</span>[<span style=color:#a6e22e>fstate</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> (<span style=color:#a6e22e>start</span><span style=color:#f92672>/</span><span style=color:#a6e22e>step</span>)) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    	<span style=color:#a6e22e>MenuObjects</span>[<span style=color:#a6e22e>index</span>][<span style=color:#ae81ff>1</span>]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></main></body></html>