<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Old bugs are harder to catch | Salman Quazi</title><meta name=keywords content="Uncategorized"><meta name=description content="About three years ago I worked on an application that in-part had to blend in with several other applications. Among many features one of them was to automatically generate something known as deadlines. The actual details are far to complicated to explain in details here, so I will use a simpler example.
Assume that you have four types of documents each have their own specific way of computing deadline. One of them follows a rule like:"><meta name=author content="Me"><link rel=canonical href=https://www.salmanq.com/blog/old-bugs-are-harder-to-catch/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.salmanq.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.salmanq.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.salmanq.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.salmanq.com/apple-touch-icon.png><link rel=mask-icon href=https://www.salmanq.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-38742121-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Old bugs are harder to catch"><meta property="og:description" content="About three years ago I worked on an application that in-part had to blend in with several other applications. Among many features one of them was to automatically generate something known as deadlines. The actual details are far to complicated to explain in details here, so I will use a simpler example.
Assume that you have four types of documents each have their own specific way of computing deadline. One of them follows a rule like:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.salmanq.com/blog/old-bugs-are-harder-to-catch/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2005-04-20T03:18:49+00:00"><meta property="article:modified_time" content="2005-04-20T03:18:49+00:00"><meta property="og:site_name" content="Salman Quazi"><meta name=twitter:card content="summary"><meta name=twitter:title content="Old bugs are harder to catch"><meta name=twitter:description content="About three years ago I worked on an application that in-part had to blend in with several other applications. Among many features one of them was to automatically generate something known as deadlines. The actual details are far to complicated to explain in details here, so I will use a simpler example.
Assume that you have four types of documents each have their own specific way of computing deadline. One of them follows a rule like:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://www.salmanq.com/blog/"},{"@type":"ListItem","position":2,"name":"Old bugs are harder to catch","item":"https://www.salmanq.com/blog/old-bugs-are-harder-to-catch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Old bugs are harder to catch","name":"Old bugs are harder to catch","description":"About three years ago I worked on an application that in-part had to blend in with several other applications. Among many features one of them was to automatically generate something known as deadlines. The actual details are far to complicated to explain in details here, so I will use a simpler example.\nAssume that you have four types of documents each have their own specific way of computing deadline. One of them follows a rule like:","keywords":["Uncategorized"],"articleBody":"About three years ago I worked on an application that in-part had to blend in with several other applications. Among many features one of them was to automatically generate something known as deadlines. The actual details are far to complicated to explain in details here, so I will use a simpler example.\nAssume that you have four types of documents each have their own specific way of computing deadline. One of them follows a rule like:\nThe deadline for document A is the fourth work day of the month unless the fifth of the month is a Friday and that friday is a workday.2. If however the month for which we are computing the deadline for is August then the deadline is 3rd Friday unless it’s happens to be a holiday; in that case then it’s the first available workday since the 3rd Friday of the month. As you can see the rule is not straight forward and involves several fine details that if programmed incorrectly will cause other systems to fail, since it feeds data to them. One such bug caused this app to fail yesterday and finally we found what the problem was. In order to see the bug I will first present to you a pseudo-code of the intial program:\nif(!FifthIsFriday(CurrentMonth, CurrentYear)) { if(CurrentMonth.GetMonth() != \"AUG\") { Deadline = FindFourthWorkDay(CurrentMonth, CurrentYear); } else { Deadline = ThirdFriday(CurrentMonth, CurrentYear); if(IsHoliday(Deadline)) { Deadline = FindNextWorkDay(Deadline); } } } else { // Fifth is a friday if(IsHoliday(DateValue(CurrentMonth+'/'+5+'/'+CurrentYear)) { Deadline = FindNextWorkDay(DateValue(CurrentMonth+'/5/'+CurrentYear)); } else { Deadline = DateValue(CurrentMonth+'/'+5+'/'+CurrentYear); } }\t/* Output deadline */ Now the corrected code.\nif(CurrentMonth.GetMonth() != \"AUG\") { Deadline = FindFourthWork(CurrentMonth, CurrentYear); } else { if(!FifthIsFriday(CurrentMonth, CurrentYear)) { Deadline = ThirdFriday(CurrentMonth, CurrentYear); if(IsHoliday(Deadline)) { Deadline = FindNextWorkDay(Deadline); } } else { // Fifth is a friday if(IsHoliday(DateValue(CurrentMonth+'/'+5+'/'+CurrentYear)) { Deadline = FindNextWorkDay(DateValue(CurrentMonth+'/5/'+CurrentYear)); } else { Deadline = DateValue(CurrentMonth+'/'+5+'/'+CurrentYear); } }\t} /* Output deadline */ As you can see both are very alike. The only difference between the two was the first checked weather Fifth was a work day and if it was it would try to schedule that as the deadline regardless of the month. However, the second code checked weather it was August first before doing FifthIsFriday.\nThe worst part of testing / writing a calendar related program specially one that deals non-deterministic time (this program could output the deadlines for 2030) is very difficult to write because date intrinsicly propose so many test cases. This bug was not caught for the past three years because the past three years none of the Augusts had fifth as friday. However this year, the 5th of August happened to be a friday and the program was computing incorrectly.\nI then thought to myself how would I have caught this bug even before causing such a problem? And the only conclusion I could come to was EXTREMELY detailed requirements; but we already knew that!\n","wordCount":"485","inLanguage":"en","datePublished":"2005-04-20T03:18:49Z","dateModified":"2005-04-20T03:18:49Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.salmanq.com/blog/old-bugs-are-harder-to-catch/"},"publisher":{"@type":"Organization","name":"Salman Quazi","logo":{"@type":"ImageObject","url":"https://www.salmanq.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.salmanq.com/ accesskey=h title="Salman Quazi (Alt + H)">Salman Quazi</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.salmanq.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://github.com/splusq/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/salmanquazi/ title=LinkedIn><span>LinkedIn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.twitter.com/splusq title=Twitter><span>Twitter</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Old bugs are harder to catch</h1><div class=post-meta><span title='2005-04-20 03:18:49 +0000 UTC'>April 20, 2005</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Me</div></header><div class=post-content><p>About three years ago I worked on an application that in-part had to blend in with several other applications. Among many features one of them was to automatically generate something known as deadlines. The actual details are far to complicated to explain in details here, so I will use a simpler example.</p><p>Assume that you have four types of documents each have their own specific way of computing deadline. One of them follows a rule like:</p><ol><li>The deadline for document A is the fourth work day of the month
unless the fifth of the month is a Friday and that friday is a workday.2. If however the month for which we are computing the deadline for is August then the deadline is 3rd Friday unless it&rsquo;s happens to be a holiday; in that case then it&rsquo;s the first available workday since the 3rd Friday of the month.</li></ol><p>As you can see the rule is not straight forward and involves several fine details that if programmed incorrectly will cause other systems to fail, since it feeds data to them. One such bug caused this app to fail yesterday and finally we found what the problem was. In order to see the bug I will first present to you a pseudo-code of the intial program:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span> <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>FifthIsFriday</span>(<span style=color:#a6e22e>CurrentMonth</span>, <span style=color:#a6e22e>CurrentYear</span>)) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>CurrentMonth</span>.<span style=color:#a6e22e>GetMonth</span>() <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;AUG&#34;</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FindFourthWorkDay</span>(<span style=color:#a6e22e>CurrentMonth</span>, <span style=color:#a6e22e>CurrentYear</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ThirdFriday</span>(<span style=color:#a6e22e>CurrentMonth</span>, <span style=color:#a6e22e>CurrentYear</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>IsHoliday</span>(<span style=color:#a6e22e>Deadline</span>)) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FindNextWorkDay</span>(<span style=color:#a6e22e>Deadline</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span> { <span style=color:#75715e>// Fifth is a friday
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>IsHoliday</span>(<span style=color:#a6e22e>DateValue</span>(<span style=color:#a6e22e>CurrentMonth</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#ae81ff>5</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>CurrentYear</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FindNextWorkDay</span>(<span style=color:#a6e22e>DateValue</span>(<span style=color:#a6e22e>CurrentMonth</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/5/&#39;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>CurrentYear</span>));
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DateValue</span>(<span style=color:#a6e22e>CurrentMonth</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#ae81ff>5</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>CurrentYear</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>Output deadline
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span> 
</span></span></code></pre></div><p>Now the corrected code.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span> <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>CurrentMonth</span>.<span style=color:#a6e22e>GetMonth</span>() <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;AUG&#34;</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FindFourthWork</span>(<span style=color:#a6e22e>CurrentMonth</span>, <span style=color:#a6e22e>CurrentYear</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>FifthIsFriday</span>(<span style=color:#a6e22e>CurrentMonth</span>, <span style=color:#a6e22e>CurrentYear</span>)) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ThirdFriday</span>(<span style=color:#a6e22e>CurrentMonth</span>, <span style=color:#a6e22e>CurrentYear</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>IsHoliday</span>(<span style=color:#a6e22e>Deadline</span>)) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FindNextWorkDay</span>(<span style=color:#a6e22e>Deadline</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span> { <span style=color:#75715e>// Fifth is a friday
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>IsHoliday</span>(<span style=color:#a6e22e>DateValue</span>(<span style=color:#a6e22e>CurrentMonth</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#ae81ff>5</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>CurrentYear</span>)) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FindNextWorkDay</span>(<span style=color:#a6e22e>DateValue</span>(<span style=color:#a6e22e>CurrentMonth</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/5/&#39;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>CurrentYear</span>));
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Deadline</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DateValue</span>(<span style=color:#a6e22e>CurrentMonth</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#ae81ff>5</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>CurrentYear</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}	
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>Output deadline
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span> 
</span></span></code></pre></div><p>As you can see both are very alike. The only difference between the two was the first checked weather Fifth was a work day and if it was it would try to schedule that as the deadline regardless of the month. However, the second code checked weather it was August first before doing FifthIsFriday.</p><p>The worst part of testing / writing a calendar related program specially one that deals non-deterministic time (this program could output the deadlines for 2030) is very difficult to write because date intrinsicly propose so many test cases. This bug was not caught for the past three years because the past three years none of the Augusts had fifth as friday. However this year, the 5th of August happened to be a friday and the program was computing incorrectly.</p><p>I then thought to myself how would I have caught this bug even before causing such a problem? And the only conclusion I could come to was EXTREMELY detailed requirements; but we <em>already knew</em> that!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.salmanq.com/tags/uncategorized/>Uncategorized</a></li></ul><nav class=paginav><a class=prev href=https://www.salmanq.com/blog/the-trailing-slash/><span class=title>« Prev</span><br><span>The trailing slash</span></a>
<a class=next href=https://www.salmanq.com/blog/mysql-version-information/><span class=title>Next »</span><br><span>MySQL version information</span></a></nav></footer><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.salmanq.com/>Salman Quazi</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>