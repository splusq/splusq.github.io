<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.134.2"><meta name=viewport content="width=device-width,initial-scale=1"><title>Verifying your site is running? &#183; Salman Quazi</title>
<meta name=description content><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/poole.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/syntax.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><style type=text/css>.sidebar-about h1{font-size:1.95rem;font-weight:400}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")</script></head><body class=theme-base-08><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://www.salmanq.com/><h1>Salman Quazi</h1></a><p class=lead>Director of Engineering for Microsoft Azure OpenAI in Mountain View, CA.</p></div><nav><ul class=sidebar-nav><li><a href=https://www.salmanq.com/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=https://github.com/splusq/>Github</a></li><li><a href=https://www.linkedin.com/in/salmanquazi/>LinkedIn</a></li><li><a href=https://www.twitter.com/splusq>Twitter</a></li></ul></nav><p>Opinions are my own.</p></div></aside><main class="content container"><div class=post><h1>Verifying your site is running?</h1><time datetime=2004-03-02T08:00:00Z class=post-date>Tue, Mar 2, 2004</time><p>This question often comes up-how do you make sure that your site is running? One solution is to run tools like <a href=http://www.ipswitch.com/products/whatsup/index.asp>WhatsUp Gold</a> that monitors your IIS service status, SQL service status etc. As long as these services respond as saying they are running, WhatsUp gold is happy. But unfortunately, the fact that these services are running does not mean that your website is functioning to the public. For example if you have a page that depends on an external web service, and for some reason the external web service is down, then your page will not respond and will eventually time out. To the public your site is down. WhatsUp gold is not necessarily going to check for that. I say not necessarily because it is possible to have WhatsUp gold monitor HTTP status, but that creates a strong coupling between WhatsUp gold and generic application development.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-perl data-lang=perl><span style=display:flex><span> error_reporting(E_ERROR);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>class servers {
</span></span><span style=display:flex><span>	public $settings <span style=color:#f92672>=</span> array();
</span></span><span style=display:flex><span>	const maxErrors <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>		        
</span></span><span style=display:flex><span>	public function add($host, $port, $url, $maxLines, $search, $subject, $to, $cc, $bcc) {
</span></span><span style=display:flex><span>		array_push($this<span style=color:#f92672>-&gt;</span>settings, 
</span></span><span style=display:flex><span>			array(
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;host&#34;</span>		<span style=color:#f92672>=&gt;</span> $host,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;port&#34;</span>		<span style=color:#f92672>=&gt;</span> $port,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;url&#34;</span> 		<span style=color:#f92672>=&gt;</span> $url,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;search&#34;</span> 	<span style=color:#f92672>=&gt;</span> $search,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;maxLines&#34;</span>	<span style=color:#f92672>=&gt;</span> $maxLines,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;subject&#34;</span>	<span style=color:#f92672>=&gt;</span> $subject,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;to&#34;</span> 		<span style=color:#f92672>=&gt;</span> $to,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;cc&#34;</span> 		<span style=color:#f92672>=&gt;</span> $cc,
</span></span><span style=display:flex><span>				<span style=color:#e6db74>&#34;bcc&#34;</span> 		<span style=color:#f92672>=&gt;</span> $bcc
</span></span><span style=display:flex><span>			)
</span></span><span style=display:flex><span>		);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>function lastState($server, $reset<span style=color:#f92672>=</span>false) {
</span></span><span style=display:flex><span>	$errorCount <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	$filename <span style=color:#f92672>=</span> md5($server[<span style=color:#e6db74>&#34;host&#34;</span>]);
</span></span><span style=display:flex><span>	$exists <span style=color:#f92672>=</span> file_exists($filename);
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$reset) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>($exists) $status <span style=color:#f92672>=</span> fopen($filename,<span style=color:#e6db74>&#34;rw+&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> $status <span style=color:#f92672>=</span> fopen($filename, <span style=color:#e6db74>&#34;x+&#34;</span>);
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$status) {
</span></span><span style=display:flex><span>			echo(<span style=color:#e6db74>&#34;Failed to open $filename (status file)\r\n&#34;</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>		$errorCount <span style=color:#f92672>=</span> (fread($status, <span style=color:#ae81ff>1</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>		$newCount <span style=color:#f92672>=</span> (($errorCount<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>		rewind($status);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		fwrite($status, $newCount, strlen($newCount));
</span></span><span style=display:flex><span>		fclose($status);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>($exists) unlink($filename);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> $errorCount;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>function error($msg, $server, $sendmail<span style=color:#f92672>=</span>true) {
</span></span><span style=display:flex><span>	echo <span style=color:#e6db74>&#34;FAILED,\&#34;&#34;</span>, str_replace(<span style=color:#e6db74>&#34;\&#34;&#34;</span>, <span style=color:#e6db74>&#34;&#39;&#34;</span>, $msg), <span style=color:#e6db74>&#34;\&#34;&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>($sendmail) {
</span></span><span style=display:flex><span>		$errorCount <span style=color:#f92672>=</span> lastState($server);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>($errorCount <span style=color:#f92672>&lt;</span> servers::maxErrors <span style=color:#f92672>&amp;&amp;</span> $errorCount<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>			$headers <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;From: \&#34;System Administrators\&#34; &lt;systems@law.ucla.edu&gt;\r\nPriority: Urgent\r\nImportance: high&#34;</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span>($server[<span style=color:#e6db74>&#34;cc&#34;</span>] <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span>) {
</span></span><span style=display:flex><span>				$headers <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;\r\nCC: {$server[&#34;</span>cc<span style=color:#e6db74>&#34;]}&#34;</span>;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span>($server[<span style=color:#e6db74>&#34;bcc&#34;</span>] <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span>) {
</span></span><span style=display:flex><span>				$headers <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;\r\nBCC: {$server[&#34;</span>bcc<span style=color:#e6db74>&#34;]}&#34;</span>;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			mail($server[<span style=color:#e6db74>&#34;to&#34;</span>], $server[<span style=color:#e6db74>&#34;subject&#34;</span>], $msg, $headers);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			echo <span style=color:#e6db74>&#34;,\&#34;(error count is $errorCount)\&#34;&#34;</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-perl data-lang=perl><span style=display:flex><span> <span style=color:#66d9ef>require</span>(<span style=color:#e6db74>&#34;functions.inc.php&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$verifyServers <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> servers();
</span></span><span style=display:flex><span>$verifyServers<span style=color:#f92672>-&gt;</span>add(<span style=color:#e6db74>&#34;www.law.ucla.edu&#34;</span>, 		<span style=color:#ae81ff>80</span>,	<span style=color:#e6db74>&#34;/home/Default.aspx&#34;</span>,	<span style=color:#ae81ff>40</span>,	<span style=color:#e6db74>&#34;UCLA School of Law&#34;</span>, 				<span style=color:#e6db74>&#34;UCLAW Down&#34;</span>,		<span style=color:#e6db74>&#34;systems@law.ucla.edu&#34;</span>, <span style=color:#e6db74>&#34;salman@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;myvirustech@vtext.com,8186481722@vtext.com,3105023584@vtext.com&#34;</span>);
</span></span><span style=display:flex><span>$verifyServers<span style=color:#f92672>-&gt;</span>add(<span style=color:#e6db74>&#34;eres.lawlib.ucla.edu&#34;</span>,		<span style=color:#ae81ff>80</span>,	<span style=color:#e6db74>&#34;/eres/Default.aspx&#34;</span>,	<span style=color:#ae81ff>80</span>,	<span style=color:#e6db74>&#34;Docutek ERes - Ereserves Home&#34;</span>,		<span style=color:#e6db74>&#34;ERes Down&#34;</span>,		<span style=color:#e6db74>&#34;systems@law.ucla.edu&#34;</span>, <span style=color:#e6db74>&#34;salman@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;myvirustech@vtext.com,3105023584@vtext.com&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#e6db74>//</span>$verifyServers<span style=color:#f92672>-&gt;</span>add(<span style=color:#e6db74>&#34;ssl://lawnet.ucla.edu&#34;</span>,		<span style=color:#ae81ff>443</span>,	<span style=color:#e6db74>&#34;/index.html&#34;</span>,		<span style=color:#ae81ff>120</span>,	<span style=color:#e6db74>&#34;UCLA School of Law Student Email System&#34;</span>,	<span style=color:#e6db74>&#34;IMail Down&#34;</span>,		<span style=color:#e6db74>&#34;systems@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;salman@law.ucla.edu&#34;</span>, 	<span style=color:#e6db74>&#34;myvirustech@vtext.com,3105023584@vtext.com&#34;</span>);
</span></span><span style=display:flex><span>$verifyServers<span style=color:#f92672>-&gt;</span>add(<span style=color:#e6db74>&#34;cyberpay.law.ucla.edu&#34;</span>,		<span style=color:#ae81ff>80</span>,	<span style=color:#e6db74>&#34;/Default.aspx&#34;</span>,	<span style=color:#ae81ff>40</span>,	<span style=color:#e6db74>&#34;CyberPay | UCLA Law&#34;</span>,				<span style=color:#e6db74>&#34;CyberPay Down&#34;</span>,	<span style=color:#e6db74>&#34;systems@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;salman@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;myvirustech@vtext.com,8186481722@vtext.com,3105023584@vtext.com&#34;</span>);
</span></span><span style=display:flex><span>$verifyServers<span style=color:#f92672>-&gt;</span>add(<span style=color:#e6db74>&#34;weblog.law.ucla.edu&#34;</span>,		<span style=color:#ae81ff>80</span>,	<span style=color:#e6db74>&#34;/index.html&#34;</span>,		<span style=color:#ae81ff>40</span>,	<span style=color:#e6db74>&#34;UCLA School of Law Blogs&#34;</span>,			<span style=color:#e6db74>&#34;Blog Down&#34;</span>,		<span style=color:#e6db74>&#34;systems@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;salman@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#e6db74>//</span>$verifyServers<span style=color:#f92672>-&gt;</span>add(<span style=color:#e6db74>&#34;ssl://webapp.law.ucla.edu&#34;</span>,	<span style=color:#ae81ff>443</span>,	<span style=color:#e6db74>&#34;/Default.asp&#34;</span>,		<span style=color:#ae81ff>40</span>,	<span style=color:#e6db74>&#34;UCLA School of Law - Online Application&#34;</span>,	<span style=color:#e6db74>&#34;J.D. Down&#34;</span>,		<span style=color:#e6db74>&#34;systems@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;salman@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>$verifyServers<span style=color:#f92672>-&gt;</span>add(<span style=color:#e6db74>&#34;www.uclalawreview.org&#34;</span>,		<span style=color:#ae81ff>80</span>,	<span style=color:#e6db74>&#34;/index.aspx&#34;</span>,		<span style=color:#ae81ff>30</span>,	<span style=color:#e6db74>&#34;Current Issue | UCLA Law Review&#34;</span>,		<span style=color:#e6db74>&#34;Law Review Down&#34;</span>,	<span style=color:#e6db74>&#34;systems@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;salman@law.ucla.edu&#34;</span>,	<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>foreach</span>($verifyServers<span style=color:#f92672>-&gt;</span>settings as $server) {
</span></span><span style=display:flex><span>	try {
</span></span><span style=display:flex><span>		echo date(<span style=color:#e6db74>&#34;Y-m-d H:i:s&#34;</span>), <span style=color:#e6db74>&#34;,&#34;</span>, $server[<span style=color:#e6db74>&#34;host&#34;</span>], <span style=color:#e6db74>&#34;,&#34;</span>;
</span></span><span style=display:flex><span>		$file<span style=color:#f92672>=</span>fsockopen($server[<span style=color:#e6db74>&#34;host&#34;</span>],$server[<span style=color:#e6db74>&#34;port&#34;</span>],$errno,$errstr,<span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$file) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span>(strlen($errstr) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) $errstr<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Unexpected error&#34;</span>;
</span></span><span style=display:flex><span>			error(<span style=color:#e6db74>&#34;$errstr ($errno)&#34;</span>, $server);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			$httpRequest <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;GET {$server[&#34;</span>url<span style=color:#e6db74>&#34;]} HTTP/1.1\r\n&#34;</span>;
</span></span><span style=display:flex><span>			$httpRequest <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;Host: {$server[&#34;</span>host<span style=color:#e6db74>&#34;]}\r\n&#34;</span>;
</span></span><span style=display:flex><span>			$httpRequest <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)\r\n&#34;</span>;
</span></span><span style=display:flex><span>			$httpRequest <span style=color:#f92672>.=</span> <span style=color:#e6db74>&#34;Connection: Close\r\n\r\n&#34;</span>;
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>			fwrite($file, $httpRequest);
</span></span><span style=display:flex><span>			$found <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>			$lines <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>while</span>(<span style=color:#f92672>!</span>feof($file)) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span>(<span style=color:#f92672>++</span>$lines <span style=color:#f92672>&lt;</span> $server[<span style=color:#e6db74>&#34;maxLines&#34;</span>] <span style=color:#f92672>&amp;&amp;</span> strpos(fgets($file), $server[<span style=color:#e6db74>&#34;search&#34;</span>]) <span style=color:#f92672>!==</span> FALSE) {
</span></span><span style=display:flex><span>					$found <span style=color:#f92672>=</span> true;
</span></span><span style=display:flex><span>					break;
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>($lines <span style=color:#f92672>&gt;</span> $server[<span style=color:#e6db74>&#34;maxLines&#34;</span>]) break;
</span></span><span style=display:flex><span>				
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$found) {
</span></span><span style=display:flex><span>				error(<span style=color:#e6db74>&#34;content error&#34;</span>, $server);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				echo <span style=color:#e6db74>&#34;OK&#34;</span>;
</span></span><span style=display:flex><span>				lastState($server, true);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		fclose($file);
</span></span><span style=display:flex><span>		echo <span style=color:#e6db74>&#34;\r\n&#34;</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	catch(Exception $ex) {
</span></span><span style=display:flex><span>		error($ex<span style=color:#f92672>-&gt;</span>Message, $server);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></main></body></html>