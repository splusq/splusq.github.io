<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Torus: Smart Array - Part II | Salman Quazi</title><meta name=keywords content="Uncategorized"><meta name=description content="As I was discussing I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.
In order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn&rsquo;t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0)."><meta name=author content="Me"><link rel=canonical href=https://www.salmanq.com/blog/torus-smart-array-part-ii/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.salmanq.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.salmanq.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.salmanq.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.salmanq.com/apple-touch-icon.png><link rel=mask-icon href=https://www.salmanq.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-38742121-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Torus: Smart Array - Part II"><meta property="og:description" content="As I was discussing I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.
In order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn&rsquo;t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0)."><meta property="og:type" content="article"><meta property="og:url" content="https://www.salmanq.com/blog/torus-smart-array-part-ii/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2004-11-30T03:49:28+00:00"><meta property="article:modified_time" content="2004-11-30T03:49:28+00:00"><meta property="og:site_name" content="Salman Quazi"><meta name=twitter:card content="summary"><meta name=twitter:title content="Torus: Smart Array - Part II"><meta name=twitter:description content="As I was discussing I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.
In order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn&rsquo;t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://www.salmanq.com/blog/"},{"@type":"ListItem","position":2,"name":"Torus: Smart Array - Part II","item":"https://www.salmanq.com/blog/torus-smart-array-part-ii/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Torus: Smart Array - Part II","name":"Torus: Smart Array - Part II","description":"As I was discussing I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.\nIn order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn\u0026rsquo;t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0).","keywords":["Uncategorized"],"articleBody":"As I was discussing I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.\nIn order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldnâ€™t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0). This was a problem. One of the solutions proposed and implemented by many others in my class was to shift the array to accomodate the space in the room. We on the other hand took a different turn; in Microsoft lingo our array was a smart array. Our array acted like a torus which meant that it would wrap around the boundaries. If for instance, the array size is: 60x60 then a reference to the point (70,40) would translate to: (19,40); in this sample case the wrap occured in the x-direction. This took care of the problem of shifting the array. Read on to see the C code for the torus functions.\nNext time I will discuss how we managed to maintain the direction we were travelling in.\n#define GRID_SIZE 10 // The size of the grid // Possible states a cell can be in #define UNKNOWN 0x0 // State is not known by the system #define VACUUMED 0x1 // It was already vacuumed #define BLOCKED 0x2 // It was found blocked #define BUFFER_SIZE 512 // buffer size of the direction (fffrr..) string // Possible directions #define XPOS 0x0 #define XNEG 0x1 #define YPOS 0x2 #define YNEG 0x3 // The memory where the state information will be stored char grid[GRID_SIZE][GRID_SIZE]; // square matrix //The current X position of the torus updated whenever moved short int torus_currentx = GRID_SIZE/2; // The current Y position of the torus updated whenever moved short int torus_currenty = GRID_SIZE/2; // The current direction of the torus updated whenever moved char torus_currentDir = XPOS; short torus_position(short); void torus_init(void); void torus_setcurrentstate(char); void torus_moverelative(short, short); void torus_findnextcell(char *); /*** Begin Torus code ***/ void torus_init() { short i,j; for(i=0;i\u003cgrid_SIZE;i++) { for(j=0;j\u003cgrid_SIZE;j++) { grid[i][j]=UNKNOWN; } } } void torus_setcurrentstate(char state) { if(torus_currentx \u003c GRID_SIZE \u0026\u0026 torus_currenty \u003c GRID_SIZE) { grid[torus_currenty][torus_currentx]=state; } } // void torus_moverelative(short fwd, short right) { if (fwd\u003e0){ switch(torus_currentDir){ case XPOS: torus_currentx++; break; case XNEG: torus_currentx--; break; case YPOS: torus_currenty++; break; case YNEG: torus_currenty--; break; } } else if (right\u003c0){ switch(torus_currentDir){ case XPOS: torus_currentDir=YPOS; break; case XNEG: torus_currentDir=YNEG; break; case YPOS: torus_currentDir=XNEG; break; case YNEG: torus_currentDir=XPOS; break; } } else if (right\u003e0){ switch(torus_currentDir){ case XPOS: torus_currentDir=YNEG; break; case XNEG: torus_currentDir=YPOS; break; case YPOS: torus_currentDir=XPOS; break; case YNEG: torus_currentDir=XNEG; break; } } if (fwd\u003c0){ switch(torus_currentDir){ case XPOS: torus_currentx--; break; case XNEG: torus_currentx++; break; case YPOS: torus_currenty--; break; case YNEG: torus_currenty++; break; } } } // uses a shortest path algorithm to find the closest unknown position // and makes directions void torus_findnextcell(char* buffer){ int tArr[GRID_SIZE][GRID_SIZE] = {{0}}; int pos=0,j,len = 1; const int qSize = 2*GRID_SIZE; int loop = 1, i = 1, x = torus_currentx, y = torus_currenty; int q[2*GRID_SIZE][3]={{0}}; int qFront = 0, qEnd=0; char tempDir,oDir; // load up the q with the current position tArr[x][y] = 1; q[qEnd][0] = x; q[qEnd][1] = y; q[qEnd++][2] = 1; // perform a bredth-first search marking the positions with distance while(loop){ // if we have exhausted the q by this point, we are done vacuuming if(qFront == qEnd){ buffer[0]='\\0'; return; } // dq next position and check edges x = q[qFront][0]; y = q[qFront][1]; len = q[qFront][2] + 1; qFront = (qFront+1)%qSize; if(x+1\u003cgrid_SIZE \u0026\u0026 grid[x+1][y]!=BLOCKED){ if(tArr[x+1][y] == 0){ tArr[x+1][y] = len; if(grid[x+1][y]==UNKNOWN){ x++; loop = 0; } q[qEnd][0] = x+1; q[qEnd][1] = y; q[qEnd][2]= len; qEnd = (qEnd+1)%(qSize); } } if(loop \u0026\u0026 x-1\u003e=0 \u0026\u0026 grid[x-1][y]!=BLOCKED){ if(tArr[x-1][y] == 0){ tArr[x-1][y] = len; if(grid[x-1][y]==UNKNOWN){ x--; loop = 0; } q[qEnd][0] = x-1; q[qEnd][1] = y; q[qEnd][2]= len; qEnd = (qEnd+1)%(qSize); } } if(loop \u0026\u0026 y+1\u003cgrid_SIZE \u0026\u0026 grid[x][y+1]!=BLOCKED){ if(tArr[x][y+1] == 0){ tArr[x][y+1] = len; if(grid[x][y+1]==UNKNOWN){ y++; loop = 0; } q[qEnd][0] = x; q[qEnd][1] = y+1; q[qEnd][2]= len; qEnd = (qEnd+1)%(qSize); } } if(loop \u0026\u0026 y-1\u003e=0 \u0026\u0026 grid[x][y-1]!=BLOCKED){ if(tArr[x][y-1] == 0){ tArr[x][y-1] = len; if(grid[x][y-1]==UNKNOWN){ y--; loop = 0; } q[qEnd][0] = x; q[qEnd][1] = y-1; q[qEnd][2]= len; qEnd = (qEnd+1)%(qSize); } } } // we've found an unknown position, we just need to record // the path to take...but we are at the destination, so // you have to think kinda backwards, at the end we will // reverse the string loop = 1; buffer[pos++] = 'f'; len--; if(x+1\u003cgrid_SIZE \u0026\u0026 tArr[x+1][y] == len){ oDir = XNEG; x++; } else if(x-1\u003e=0 \u0026\u0026 tArr[x-1][y] == len){ oDir = XPOS; x--; } else if(y+1\u003cgrid_SIZE \u0026\u0026 tArr[x][y+1] == len){ oDir = YNEG; y++; } else if(y-1\u003e=0 \u0026\u0026 tArr[x][y-1] == len){ oDir = YPOS; y--; } tempDir = torus_currentDir; for(i=len-1;i\u003e0;i--){ if(x+1\u003cgrid_SIZE \u0026\u0026 tArr[x+1][y] == i){ if(tempDir == YPOS) buffer[pos++]='r'; if(tempDir == YNEG) buffer[pos++]='l'; tempDir = XNEG; x++; } else if(x-1\u003e=0 \u0026\u0026 tArr[x-1][y] == i){ if(tempDir == YPOS) buffer[pos++]='l'; if(tempDir == YNEG) buffer[pos++]='r'; tempDir = XPOS; x--; } else if(y+1\u003cgrid_SIZE \u0026\u0026 tArr[x][y+1] == i){ if(tempDir == XPOS) buffer[pos++]='l'; if(tempDir == XNEG) buffer[pos++]='r'; tempDir = YNEG; y++; } else if(y-1\u003e=0 \u0026\u0026 tArr[x][y-1] == i){ if(tempDir == XPOS) buffer[pos++]='r'; if(tempDir == XNEG) buffer[pos++]='l'; tempDir = YPOS; y--; } buffer[pos++]='f'; } // using the last known direction of the robot, we need to // find out how much to turn to start on the path if(torus_currentDir == XPOS){ if(tempDir == YPOS) buffer[pos++]='l'; else if(tempDir == YNEG) buffer[pos++]='r'; else if(tempDir == XNEG){ buffer[pos++]='r'; buffer[pos++]='r'; } } else if(torus_currentDir == XNEG){ if(tempDir == YPOS) buffer[pos++]='r'; else if(tempDir == YNEG) buffer[pos++]='l'; else if(tempDir == XPOS){ buffer[pos++]='r'; buffer[pos++]='r'; } } else if(torus_currentDir == YPOS){ if(tempDir == XPOS) buffer[pos++]='r'; else if(tempDir == XNEG) buffer[pos++]='l'; else if(tempDir == YNEG){ buffer[pos++]='r'; buffer[pos++]='r'; } } if(torus_currentDir == YNEG){ if(tempDir == XPOS) buffer[pos++]='l'; else if(tempDir == XNEG) buffer[pos++]='r'; else if(tempDir == YPOS){ buffer[pos++]='r'; buffer[pos++]='r'; } } // now reverse the string and end it and wee are done for(i=0,j=pos-1;j\u003ei;i++,j--){ tempDir = buffer[i]; buffer[i]= buffer[j]; buffer[j]=tempDir; } buffer[pos]='\\0'; } /*** End Torus Code ***/ ","wordCount":"1034","inLanguage":"en","datePublished":"2004-11-30T03:49:28Z","dateModified":"2004-11-30T03:49:28Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.salmanq.com/blog/torus-smart-array-part-ii/"},"publisher":{"@type":"Organization","name":"Salman Quazi","logo":{"@type":"ImageObject","url":"https://www.salmanq.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.salmanq.com/ accesskey=h title="Salman Quazi (Alt + H)">Salman Quazi</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.salmanq.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://github.com/splusq/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/salmanquazi/ title=LinkedIn><span>LinkedIn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.twitter.com/splusq title=Twitter><span>Twitter</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><div class=post><h1>Torus: Smart Array - Part II</h1><time datetime=2004-11-30T03:49:28Z class=post-date>Tue, Nov 30, 2004</time><p><a href=/blog/vacuum-cleaner/>As I was discussing</a> I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.</p><p>In order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn&rsquo;t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0). This was a problem. One of the solutions proposed and implemented by many others in my class was to <em>shift</em> the array to accomodate the space in the room. We on the other hand took a different turn; in Microsoft lingo our array was a smart array. Our array acted like a torus which meant that it would wrap around the boundaries. If for instance, the array size is: 60x60 then a reference to the point (70,40) would translate to: (19,40); in this sample case the wrap occured in the x-direction. This took care of the problem of shifting the array. Read on to see the C code for the torus functions.</p><p><em>Next time I will discuss how we managed to maintain the direction we were travelling in.</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#define GRID_SIZE 10 </span><span style=color:#75715e>// The size of the grid
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Possible states a cell can be in
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#define UNKNOWN  0x0 </span><span style=color:#75715e>// State is not known by the system
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#define VACUUMED 0x1 </span><span style=color:#75715e>// It was already vacuumed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#define BLOCKED  0x2 </span><span style=color:#75715e>// It was found blocked
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#define BUFFER_SIZE 512 </span><span style=color:#75715e>// buffer size of the direction (fffrr..) string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Possible directions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#define XPOS 0x0
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define XNEG 0x1
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define YPOS 0x2
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define YNEG 0x3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The memory where the state information will be stored
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>char</span> grid[GRID_SIZE][GRID_SIZE]; <span style=color:#75715e>// square matrix
</span></span></span><span style=display:flex><span><span style=color:#75715e>//The current X position of the torus updated whenever moved
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>short</span> <span style=color:#66d9ef>int</span> torus_currentx <span style=color:#f92672>=</span> GRID_SIZE<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>; 
</span></span><span style=display:flex><span><span style=color:#75715e>// The current Y position of the torus updated whenever moved
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>short</span> <span style=color:#66d9ef>int</span> torus_currenty <span style=color:#f92672>=</span> GRID_SIZE<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>; 
</span></span><span style=display:flex><span><span style=color:#75715e>// The current direction of the torus updated  whenever moved
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>char</span> torus_currentDir <span style=color:#f92672>=</span> XPOS; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>short</span> <span style=color:#a6e22e>torus_position</span>(<span style=color:#66d9ef>short</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_init</span>(<span style=color:#66d9ef>void</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_setcurrentstate</span>(<span style=color:#66d9ef>char</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_moverelative</span>(<span style=color:#66d9ef>short</span>, <span style=color:#66d9ef>short</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_findnextcell</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/***  Begin Torus code ***/</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_init</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>short</span> i,j;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span>(i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span>grid_SIZE;i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span>(j<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;j<span style=color:#f92672>&lt;</span>grid_SIZE;j<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                        grid[i][j]<span style=color:#f92672>=</span>UNKNOWN;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_setcurrentstate</span>(<span style=color:#66d9ef>char</span> state) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(torus_currentx <span style=color:#f92672>&lt;</span> GRID_SIZE <span style=color:#f92672>&amp;&amp;</span> torus_currenty <span style=color:#f92672>&lt;</span> GRID_SIZE) {
</span></span><span style=display:flex><span>                grid[torus_currenty][torus_currentx]<span style=color:#f92672>=</span>state;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_moverelative</span>(<span style=color:#66d9ef>short</span> fwd, <span style=color:#66d9ef>short</span> right) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (fwd<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>switch</span>(torus_currentDir){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XPOS:
</span></span><span style=display:flex><span>                        torus_currentx<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XNEG:
</span></span><span style=display:flex><span>                        torus_currentx<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YPOS:
</span></span><span style=display:flex><span>                        torus_currenty<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YNEG:
</span></span><span style=display:flex><span>                        torus_currenty<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (right<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>switch</span>(torus_currentDir){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XPOS:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>YPOS;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XNEG:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>YNEG;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YPOS:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>XNEG;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YNEG:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>XPOS;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (right<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>switch</span>(torus_currentDir){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XPOS:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>YNEG;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XNEG:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>YPOS;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YPOS:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>XPOS;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YNEG:
</span></span><span style=display:flex><span>                        torus_currentDir<span style=color:#f92672>=</span>XNEG;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (fwd<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>switch</span>(torus_currentDir){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XPOS:
</span></span><span style=display:flex><span>                        torus_currentx<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> XNEG:
</span></span><span style=display:flex><span>                        torus_currentx<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YPOS:
</span></span><span style=display:flex><span>                        torus_currenty<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> YNEG:
</span></span><span style=display:flex><span>                        torus_currenty<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// uses a shortest path algorithm to find the closest unknown position
</span></span></span><span style=display:flex><span><span style=color:#75715e>// and makes directions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>torus_findnextcell</span>(<span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> buffer){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> tArr[GRID_SIZE][GRID_SIZE] <span style=color:#f92672>=</span> {{<span style=color:#ae81ff>0</span>}};
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> pos<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,j,len <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span> qSize <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>GRID_SIZE;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> loop <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, i <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, x <span style=color:#f92672>=</span> torus_currentx, y <span style=color:#f92672>=</span> torus_currenty;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> q[<span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>GRID_SIZE][<span style=color:#ae81ff>3</span>]<span style=color:#f92672>=</span>{{<span style=color:#ae81ff>0</span>}};
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> qFront <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, qEnd<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span> tempDir,oDir;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// load up the q with the current position
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        tArr[x][y] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        q[qEnd][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> x;
</span></span><span style=display:flex><span>        q[qEnd][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> y;
</span></span><span style=display:flex><span>        q[qEnd<span style=color:#f92672>++</span>][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// perform a bredth-first search marking the positions with distance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>while</span>(loop){
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// if we have exhausted the q by this point, we are done vacuuming
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span>(qFront <span style=color:#f92672>==</span> qEnd){
</span></span><span style=display:flex><span>                        buffer[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>// dq next position and check edges
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                x <span style=color:#f92672>=</span> q[qFront][<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>                y <span style=color:#f92672>=</span> q[qFront][<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>                len <span style=color:#f92672>=</span> q[qFront][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                qFront <span style=color:#f92672>=</span> (qFront<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>%</span>qSize;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;</span>grid_SIZE <span style=color:#f92672>&amp;&amp;</span> grid[x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][y]<span style=color:#f92672>!=</span>BLOCKED){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tArr[x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                                tArr[x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>if</span>(grid[x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][y]<span style=color:#f92672>==</span>UNKNOWN){
</span></span><span style=display:flex><span>                                        x<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                                        loop <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> y;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>2</span>]<span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                qEnd <span style=color:#f92672>=</span> (qEnd<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>%</span>(qSize);
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(loop <span style=color:#f92672>&amp;&amp;</span> x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> grid[x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][y]<span style=color:#f92672>!=</span>BLOCKED){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tArr[x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                                tArr[x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>if</span>(grid[x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][y]<span style=color:#f92672>==</span>UNKNOWN){
</span></span><span style=display:flex><span>                                        x<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                                        loop <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> y;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>2</span>]<span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                qEnd <span style=color:#f92672>=</span> (qEnd<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>%</span>(qSize);
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(loop <span style=color:#f92672>&amp;&amp;</span> y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;</span>grid_SIZE <span style=color:#f92672>&amp;&amp;</span> grid[x][y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>!=</span>BLOCKED){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tArr[x][y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                                tArr[x][y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>if</span>(grid[x][y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>==</span>UNKNOWN){
</span></span><span style=display:flex><span>                                        y<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                                        loop <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> x;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>2</span>]<span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                qEnd <span style=color:#f92672>=</span> (qEnd<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>%</span>(qSize);
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(loop <span style=color:#f92672>&amp;&amp;</span> y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> grid[x][y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>!=</span>BLOCKED){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tArr[x][y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>                                tArr[x][y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>if</span>(grid[x][y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>==</span>UNKNOWN){
</span></span><span style=display:flex><span>                                        y<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                                        loop <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>                                }
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> x;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>                                q[qEnd][<span style=color:#ae81ff>2</span>]<span style=color:#f92672>=</span> len;
</span></span><span style=display:flex><span>                                qEnd <span style=color:#f92672>=</span> (qEnd<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>%</span>(qSize);
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// we&#39;ve found an unknown position, we just need to record
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// the path to take...but we are at the destination, so 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// you have to think kinda backwards, at the end we will
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// reverse the string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        loop <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>        buffer[pos<span style=color:#f92672>++</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;f&#39;</span>;
</span></span><span style=display:flex><span>        len<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;</span>grid_SIZE <span style=color:#f92672>&amp;&amp;</span> tArr[x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>==</span> len){
</span></span><span style=display:flex><span>                oDir <span style=color:#f92672>=</span> XNEG;
</span></span><span style=display:flex><span>                x<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> tArr[x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>==</span> len){
</span></span><span style=display:flex><span>                oDir <span style=color:#f92672>=</span> XPOS;
</span></span><span style=display:flex><span>                x<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;</span>grid_SIZE <span style=color:#f92672>&amp;&amp;</span> tArr[x][y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> len){
</span></span><span style=display:flex><span>                oDir <span style=color:#f92672>=</span> YNEG;
</span></span><span style=display:flex><span>                y<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> tArr[x][y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> len){
</span></span><span style=display:flex><span>                oDir <span style=color:#f92672>=</span> YPOS;
</span></span><span style=display:flex><span>                y<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        tempDir <span style=color:#f92672>=</span> torus_currentDir;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span>(i<span style=color:#f92672>=</span>len<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;i<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>--</span>){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;</span>grid_SIZE <span style=color:#f92672>&amp;&amp;</span> tArr[x<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>==</span> i){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YPOS)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YNEG)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                        tempDir <span style=color:#f92672>=</span> XNEG;
</span></span><span style=display:flex><span>                        x<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> tArr[x<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>][y] <span style=color:#f92672>==</span> i){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YPOS)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YNEG)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        tempDir <span style=color:#f92672>=</span> XPOS;
</span></span><span style=display:flex><span>                        x<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&lt;</span>grid_SIZE <span style=color:#f92672>&amp;&amp;</span> tArr[x][y<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> i){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XPOS)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XNEG)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        tempDir <span style=color:#f92672>=</span> YNEG;
</span></span><span style=display:flex><span>                        y<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> tArr[x][y<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> i){
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XPOS)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XNEG)
</span></span><span style=display:flex><span>                                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                        tempDir <span style=color:#f92672>=</span> YPOS;
</span></span><span style=display:flex><span>                        y<span style=color:#f92672>--</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;f&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// using the last known direction of the robot, we need to
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// find out how much to turn to start on the path
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span>(torus_currentDir <span style=color:#f92672>==</span> XPOS){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YPOS)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YNEG)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XNEG){
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(torus_currentDir <span style=color:#f92672>==</span> XNEG){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YPOS)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YNEG)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XPOS){
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(torus_currentDir <span style=color:#f92672>==</span> YPOS){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XPOS)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XNEG)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YNEG){
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(torus_currentDir <span style=color:#f92672>==</span> YNEG){
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XPOS)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;l&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> XNEG)
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(tempDir <span style=color:#f92672>==</span> YPOS){
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                        buffer[pos<span style=color:#f92672>++</span>]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;r&#39;</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// now reverse the string and end it and wee are done
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>for</span>(i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,j<span style=color:#f92672>=</span>pos<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;j<span style=color:#f92672>&gt;</span>i;i<span style=color:#f92672>++</span>,j<span style=color:#f92672>--</span>){
</span></span><span style=display:flex><span>                tempDir <span style=color:#f92672>=</span> buffer[i];
</span></span><span style=display:flex><span>                buffer[i]<span style=color:#f92672>=</span> buffer[j];
</span></span><span style=display:flex><span>                buffer[j]<span style=color:#f92672>=</span>tempDir;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        buffer[pos]<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;\0&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>/*** End Torus Code ***/</span> 
</span></span></code></pre></div></div><br><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></main><footer class=footer><span>&copy; 2023 <a href=https://www.salmanq.com/>Salman Quazi</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>