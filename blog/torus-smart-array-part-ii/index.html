<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Torus: Smart Array - Part II | Salman Quazi</title><meta property="og:title" content="Torus: Smart Array - Part II | Salman Quazi"><meta name=twitter:title content="Torus: Smart Array - Part II | Salman Quazi"><meta itemprop=name content="Torus: Smart Array - Part II | Salman Quazi"><meta name=application-name content="Torus: Smart Array - Part II | Salman Quazi"><meta property="og:site_name" content="Salman Quazi"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:locale" content="en-us"><meta name=language content="en-us"><link rel=alternate hreflang=en href=https://www.salmanq.com/blog/torus-smart-array-part-ii/ title><meta name=generator content="Hugo 0.155.3"><meta property="og:url" content="https://www.salmanq.com/blog/torus-smart-array-part-ii/"><meta property="og:site_name" content="Salman Quazi"><meta property="og:title" content="Torus: Smart Array - Part II"><meta property="og:description" content="As I was discussing I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.
In order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn’t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0). This was a problem. One of the solutions proposed and implemented by many others in my class was to shift the array to accomodate the space in the room. We on the other hand took a different turn; in Microsoft lingo our array was a smart array. Our array acted like a torus which meant that it would wrap around the boundaries. If for instance, the array size is: 60x60 then a reference to the point (70,40) would translate to: (19,40); in this sample case the wrap occured in the x-direction. This took care of the problem of shifting the array. Read on to see the C code for the torus functions."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2004-11-30T03:49:28+00:00"><meta property="article:modified_time" content="2004-11-30T03:49:28+00:00"><meta property="article:tag" content="Robotics"><meta property="article:tag" content="Algorithms"><meta name=twitter:card content="summary"><meta name=twitter:title content="Torus: Smart Array - Part II"><meta name=twitter:description content="As I was discussing I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.
In order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn’t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0). This was a problem. One of the solutions proposed and implemented by many others in my class was to shift the array to accomodate the space in the room. We on the other hand took a different turn; in Microsoft lingo our array was a smart array. Our array acted like a torus which meant that it would wrap around the boundaries. If for instance, the array size is: 60x60 then a reference to the point (70,40) would translate to: (19,40); in this sample case the wrap occured in the x-direction. This took care of the problem of shifting the array. Read on to see the C code for the torus functions."><link rel=canonical href=https://www.salmanq.com/blog/torus-smart-array-part-ii/><link href=/style.min.862147bbb377d23687efce486cb224b7ee4e5547f8a3c94985e4bde0bcb144b3.css rel=stylesheet><link href=/code-highlight.min.225cdda98fd38fb9327516ffd3e7d454264692605379c91ee645ea102a7b4b4f.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://www.salmanq.com/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")}</script></head><body data-theme=dark class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://www.salmanq.com/ class=logo><span class=monogram>SQ</span>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/blog/>Blog</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
<svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Torus: Smart Array - Part II</h1><div class=post-meta><time datetime=2004-11-30T03:49:28+00:00 itemprop=datePublished>Nov 30, 2004 </time><span class=reading-time>&#183; 5 min read</span></div><div class=post-tags><a class=tag href=https://www.salmanq.com/tags/robotics/>Robotics</a>
<a class=tag href=https://www.salmanq.com/tags/algorithms/>Algorithms</a></div></header><div class=page-content><p><a href=/blog/vacuum-cleaner/>As I was discussing</a> I am working on an intelligent vacuum cleaner. In this article I will discuss how we did our state management for the surface the robot is vacuuming.</p><p>In order to maintain the state information for the surface, one of things we had for our intelligent Roomba was a char array (VACUUMED, UNKNOWN, BLOCKED are the possible values for each cell). However a simple array wouldn&rsquo;t work because the robot could be physically placed anywhere on the floor, yet our starting position would always be (0,0). This was a problem. One of the solutions proposed and implemented by many others in my class was to <em>shift</em> the array to accomodate the space in the room. We on the other hand took a different turn; in Microsoft lingo our array was a smart array. Our array acted like a torus which meant that it would wrap around the boundaries. If for instance, the array size is: 60x60 then a reference to the point (70,40) would translate to: (19,40); in this sample case the wrap occured in the x-direction. This took care of the problem of shifting the array. Read on to see the C code for the torus functions.</p><p><em>Next time I will discuss how we managed to maintain the direction we were travelling in.</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define GRID_SIZE 10 </span><span class=c1>// The size of the grid
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Possible states a cell can be in
</span></span></span><span class=line><span class=cl><span class=cp>#define UNKNOWN  0x0 </span><span class=c1>// State is not known by the system
</span></span></span><span class=line><span class=cl><span class=cp>#define VACUUMED 0x1 </span><span class=c1>// It was already vacuumed
</span></span></span><span class=line><span class=cl><span class=cp>#define BLOCKED  0x2 </span><span class=c1>// It was found blocked
</span></span></span><span class=line><span class=cl><span class=cp>#define BUFFER_SIZE 512 </span><span class=c1>// buffer size of the direction (fffrr..) string
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Possible directions
</span></span></span><span class=line><span class=cl><span class=cp>#define XPOS 0x0
</span></span></span><span class=line><span class=cl><span class=cp>#define XNEG 0x1
</span></span></span><span class=line><span class=cl><span class=cp>#define YPOS 0x2
</span></span></span><span class=line><span class=cl><span class=cp>#define YNEG 0x3
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The memory where the state information will be stored
</span></span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>grid</span><span class=p>[</span><span class=n>GRID_SIZE</span><span class=p>][</span><span class=n>GRID_SIZE</span><span class=p>];</span> <span class=c1>// square matrix
</span></span></span><span class=line><span class=cl><span class=c1>//The current X position of the torus updated whenever moved
</span></span></span><span class=line><span class=cl><span class=kt>short</span> <span class=kt>int</span> <span class=n>torus_currentx</span> <span class=o>=</span> <span class=n>GRID_SIZE</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=c1>// The current Y position of the torus updated whenever moved
</span></span></span><span class=line><span class=cl><span class=kt>short</span> <span class=kt>int</span> <span class=n>torus_currenty</span> <span class=o>=</span> <span class=n>GRID_SIZE</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=c1>// The current direction of the torus updated  whenever moved
</span></span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>torus_currentDir</span> <span class=o>=</span> <span class=n>XPOS</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>short</span> <span class=nf>torus_position</span><span class=p>(</span><span class=kt>short</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_init</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_setcurrentstate</span><span class=p>(</span><span class=kt>char</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_moverelative</span><span class=p>(</span><span class=kt>short</span><span class=p>,</span> <span class=kt>short</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_findnextcell</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/***  Begin Torus code ***/</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>short</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>grid_SIZE</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>grid_SIZE</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>UNKNOWN</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_setcurrentstate</span><span class=p>(</span><span class=kt>char</span> <span class=n>state</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>torus_currentx</span> <span class=o>&lt;</span> <span class=n>GRID_SIZE</span> <span class=o>&amp;&amp;</span> <span class=n>torus_currenty</span> <span class=o>&lt;</span> <span class=n>GRID_SIZE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>grid</span><span class=p>[</span><span class=n>torus_currenty</span><span class=p>][</span><span class=n>torus_currentx</span><span class=p>]</span><span class=o>=</span><span class=n>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_moverelative</span><span class=p>(</span><span class=kt>short</span> <span class=n>fwd</span><span class=p>,</span> <span class=kt>short</span> <span class=n>right</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>fwd</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>switch</span><span class=p>(</span><span class=n>torus_currentDir</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentx</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentx</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currenty</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currenty</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>right</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>switch</span><span class=p>(</span><span class=n>torus_currentDir</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>YPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>YNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>XNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>XPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>right</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>switch</span><span class=p>(</span><span class=n>torus_currentDir</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>YNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>YPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>XPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentDir</span><span class=o>=</span><span class=n>XNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>fwd</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>switch</span><span class=p>(</span><span class=n>torus_currentDir</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentx</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>XNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currentx</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YPOS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currenty</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=nl>YNEG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>torus_currenty</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// uses a shortest path algorithm to find the closest unknown position
</span></span></span><span class=line><span class=cl><span class=c1>// and makes directions
</span></span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>torus_findnextcell</span><span class=p>(</span><span class=kt>char</span><span class=o>*</span> <span class=n>buffer</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>tArr</span><span class=p>[</span><span class=n>GRID_SIZE</span><span class=p>][</span><span class=n>GRID_SIZE</span><span class=p>]</span> <span class=o>=</span> <span class=p>{{</span><span class=mi>0</span><span class=p>}};</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>pos</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>len</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=kt>int</span> <span class=n>qSize</span> <span class=o>=</span> <span class=mi>2</span><span class=o>*</span><span class=n>GRID_SIZE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>loop</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>x</span> <span class=o>=</span> <span class=n>torus_currentx</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>torus_currenty</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>q</span><span class=p>[</span><span class=mi>2</span><span class=o>*</span><span class=n>GRID_SIZE</span><span class=p>][</span><span class=mi>3</span><span class=p>]</span><span class=o>=</span><span class=p>{{</span><span class=mi>0</span><span class=p>}};</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>qFront</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>qEnd</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>tempDir</span><span class=p>,</span><span class=n>oDir</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// load up the q with the current position
</span></span></span><span class=line><span class=cl>        <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=o>++</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// perform a bredth-first search marking the positions with distance
</span></span></span><span class=line><span class=cl>        <span class=k>while</span><span class=p>(</span><span class=n>loop</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// if we have exhausted the q by this point, we are done vacuuming
</span></span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>qFront</span> <span class=o>==</span> <span class=n>qEnd</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>// dq next position and check edges
</span></span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=n>q</span><span class=p>[</span><span class=n>qFront</span><span class=p>][</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=n>q</span><span class=p>[</span><span class=n>qFront</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>len</span> <span class=o>=</span> <span class=n>q</span><span class=p>[</span><span class=n>qFront</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>qFront</span> <span class=o>=</span> <span class=p>(</span><span class=n>qFront</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=n>qSize</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>grid_SIZE</span> <span class=o>&amp;&amp;</span> <span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>!=</span><span class=n>BLOCKED</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=k>if</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>==</span><span class=n>UNKNOWN</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                        <span class=n>x</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                        <span class=n>loop</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>qEnd</span> <span class=o>=</span> <span class=p>(</span><span class=n>qEnd</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=p>(</span><span class=n>qSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>loop</span> <span class=o>&amp;&amp;</span> <span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>!=</span><span class=n>BLOCKED</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=k>if</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span><span class=o>==</span><span class=n>UNKNOWN</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                        <span class=n>x</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                        <span class=n>loop</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>qEnd</span> <span class=o>=</span> <span class=p>(</span><span class=n>qEnd</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=p>(</span><span class=n>qSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>loop</span> <span class=o>&amp;&amp;</span> <span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>grid_SIZE</span> <span class=o>&amp;&amp;</span> <span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>!=</span><span class=n>BLOCKED</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=k>if</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span><span class=o>==</span><span class=n>UNKNOWN</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                        <span class=n>y</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                        <span class=n>loop</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>qEnd</span> <span class=o>=</span> <span class=p>(</span><span class=n>qEnd</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=p>(</span><span class=n>qSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>loop</span> <span class=o>&amp;&amp;</span> <span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>!=</span><span class=n>BLOCKED</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=k>if</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>==</span><span class=n>UNKNOWN</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                                        <span class=n>y</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                        <span class=n>loop</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>q</span><span class=p>[</span><span class=n>qEnd</span><span class=p>][</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                                <span class=n>qEnd</span> <span class=o>=</span> <span class=p>(</span><span class=n>qEnd</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=p>(</span><span class=n>qSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// we&#39;ve found an unknown position, we just need to record
</span></span></span><span class=line><span class=cl>        <span class=c1>// the path to take...but we are at the destination, so 
</span></span></span><span class=line><span class=cl>        <span class=c1>// you have to think kinda backwards, at the end we will
</span></span></span><span class=line><span class=cl>        <span class=c1>// reverse the string
</span></span></span><span class=line><span class=cl>        <span class=n>loop</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;f&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>len</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>grid_SIZE</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>==</span> <span class=n>len</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>oDir</span> <span class=o>=</span> <span class=n>XNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>==</span> <span class=n>len</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>oDir</span> <span class=o>=</span> <span class=n>XPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>grid_SIZE</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>len</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>oDir</span> <span class=o>=</span> <span class=n>YNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>len</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>oDir</span> <span class=o>=</span> <span class=n>YPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>tempDir</span> <span class=o>=</span> <span class=n>torus_currentDir</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=n>len</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>grid_SIZE</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>==</span> <span class=n>i</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>tempDir</span> <span class=o>=</span> <span class=n>XNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>x</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>==</span> <span class=n>i</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>tempDir</span> <span class=o>=</span> <span class=n>XPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>x</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=o>&lt;</span><span class=n>grid_SIZE</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>i</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>tempDir</span> <span class=o>=</span> <span class=n>YNEG</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>y</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=o>&gt;=</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>tArr</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>i</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>tempDir</span> <span class=o>=</span> <span class=n>YPOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>y</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;f&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// using the last known direction of the robot, we need to
</span></span></span><span class=line><span class=cl>        <span class=c1>// find out how much to turn to start on the path
</span></span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>torus_currentDir</span> <span class=o>==</span> <span class=n>XPOS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XNEG</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>torus_currentDir</span> <span class=o>==</span> <span class=n>XNEG</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XPOS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>torus_currentDir</span> <span class=o>==</span> <span class=n>YPOS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YNEG</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>torus_currentDir</span> <span class=o>==</span> <span class=n>YNEG</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XPOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;l&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>XNEG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>tempDir</span> <span class=o>==</span> <span class=n>YPOS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=o>++</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;r&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// now reverse the string and end it and wee are done
</span></span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>j</span><span class=o>=</span><span class=n>pos</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span><span class=n>j</span><span class=o>&gt;</span><span class=n>i</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>,</span><span class=n>j</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>tempDir</span> <span class=o>=</span> <span class=n>buffer</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>buffer</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span> <span class=n>buffer</span><span class=p>[</span><span class=n>j</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>buffer</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>=</span><span class=n>tempDir</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>buffer</span><span class=p>[</span><span class=n>pos</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*** End Torus Code ***/</span> 
</span></span></code></pre></div></div><section class=comments-section><h2 class=comments-heading>Comments</h2><div id=utterances-container></div><script>(function(){function s(){return document.documentElement.classList.contains("dark")||!document.documentElement.classList.contains("light")&&window.matchMedia("(prefers-color-scheme: dark)").matches}function t(){return s()?"github-dark":"github-light"}var n,e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo","splusq/splusq.github.io"),e.setAttribute("issue-term","title"),e.setAttribute("theme",t()),e.setAttribute("crossorigin","anonymous"),e.async=!0,document.getElementById("utterances-container").appendChild(e),n=new MutationObserver(function(e){e.forEach(function(e){if(e.attributeName==="class"){var n=document.querySelector(".utterances-frame");n&&n.contentWindow.postMessage({type:"set-theme",theme:t()},"https://utteranc.es")}})}),n.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})})()</script></section></article></main></div><footer class=footer><p class=footer_tagline>Engineering, architecture, and the craft of building software.</p><div class=footer_links><a href=/>Home</a>
<a href=/blog/>Blog</a>
<a href=https://github.com/splusq>GitHub</a>
<a href=https://www.linkedin.com/in/salmanquazi/>LinkedIn</a></div><div class=footer_social-icons><a href=https://github.com/splusq target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://www.twitter.com/splusq target=_blank rel="noopener noreferrer me" title=Twitter><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a><a href=https://www.linkedin.com/in/salmanquazi/ target=_blank rel="noopener noreferrer me" title=Linkedin><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>&copy; 2026 Salman Quazi.</small></footer><a href=# title="Go to top" id=totop><svg width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg>
</a><script src=https://www.salmanq.com/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>