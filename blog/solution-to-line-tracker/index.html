<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.134.2"><meta name=viewport content="width=device-width,initial-scale=1"><title>Solution to Line Tracker &#183; Salman Quazi</title>
<meta name=description content><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/poole.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/syntax.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><style type=text/css>.sidebar-about h1{font-size:1.95rem;font-weight:400}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")</script></head><body class=theme-base-08><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://www.salmanq.com/><h1>Salman Quazi</h1></a><p class=lead>Director of Engineering for Microsoft Azure OpenAI in Mountain View, CA.</p></div><nav><ul class=sidebar-nav><li><a href=https://www.salmanq.com/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=https://github.com/splusq/>Github</a></li><li><a href=https://www.linkedin.com/in/salmanquazi/>LinkedIn</a></li><li><a href=https://www.twitter.com/splusq>Twitter</a></li></ul></nav><p>Opinions are my own.</p></div></aside><main class="content container"><div class=post><h1>Solution to Line Tracker</h1><time datetime=2004-10-02T01:17:34Z class=post-date>Sat, Oct 2, 2004</time><p>In my <a href=/blog/line-tracker/>previous post</a> I discussed an algorithm that it is much better than the <em>general</em> line following algorithm that one might think of at first. Last night I implemented the algorithm with NQC with descent results. Here&rsquo;s the solution:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>/***********************************************
</span></span></span><span style=display:flex><span><span style=color:#75715e>	* Salman Quazi
</span></span></span><span style=display:flex><span><span style=color:#75715e>	* CS-595EA
</span></span></span><span style=display:flex><span><span style=color:#75715e>	* Date: September 19, 2004
</span></span></span><span style=display:flex><span><span style=color:#75715e>***********************************************/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* Constant Definitions */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define SENSOR		SENSOR_1
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define LEFT_MOTOR	OUT_C
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define RIGHT_MOTOR	OUT_A
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* Speed settings */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define NORMAL_SPEED 7
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define TURN_SPEED 2
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define DELAY	20
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* This setting depends on several conditions like: lighting, contrast between the tape and the floor ... */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define LINE_COLOR 768
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define FLOOR_COLOR 710
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> eye;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* I have been thinking about taking the average color of the 
</span></span></span><span style=display:flex><span><span style=color:#75715e>floor and the black tape for more reliable results */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> average_color <span style=color:#f92672>=</span> (LINE_COLOR<span style=color:#f92672>+</span>FLOOR_COLOR)<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>task <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SetPower</span>(LEFT_MOTOR,  NORMAL_SPEED);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>SetPower</span>(RIGHT_MOTOR, NORMAL_SPEED);
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>OnFwd</span>(LEFT_MOTOR<span style=color:#f92672>+</span>RIGHT_MOTOR);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>while</span>(true) {
</span></span><span style=display:flex><span>		eye <span style=color:#f92672>=</span> SENSOR;
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>SelectDisplay</span>(DISPLAY_SENSOR_1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (eye <span style=color:#f92672>&lt;=</span> FLOOR_COLOR) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>SetPower</span>(LEFT_MOTOR<span style=color:#f92672>+</span>RIGHT_MOTOR, TURN_SPEED);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Fwd</span>(RIGHT_MOTOR);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Rev</span>(LEFT_MOTOR);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>On</span>(LEFT_MOTOR<span style=color:#f92672>+</span>RIGHT_MOTOR);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>while</span>(SENSOR <span style=color:#f92672>&lt;=</span> FLOOR_COLOR);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (eye <span style=color:#f92672>&gt;=</span> LINE_COLOR) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>SetPower</span>(LEFT_MOTOR<span style=color:#f92672>+</span>RIGHT_MOTOR, TURN_SPEED);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Fwd</span>(LEFT_MOTOR);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>Rev</span>(RIGHT_MOTOR);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>On</span>(LEFT_MOTOR<span style=color:#f92672>+</span>RIGHT_MOTOR);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>while</span>(SENSOR <span style=color:#f92672>&gt;=</span> LINE_COLOR);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>continue</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>SetPower</span>(LEFT_MOTOR<span style=color:#f92672>+</span>RIGHT_MOTOR, NORMAL_SPEED);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Fwd</span>(LEFT_MOTOR);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Fwd</span>(RIGHT_MOTOR);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>On</span>(LEFT_MOTOR<span style=color:#f92672>+</span>RIGHT_MOTOR);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>This was compiled with <a href=http://bricxcc.sourceforge.net/nqc/release/index.html>NQC version 2.5 r3</a> on <a href=http://mindstorms.lego.com/support/en/ris20.asp>RCX 2.0</a> (on a Windows 2000 Professional system).</p><p>Of course there is room for improvement. (1) Increase NORMAL_SPEED and still be able to follow the line (by reducing latency speed). (2) If the system encounters an object while travelling the line then it should get around it somehow, and so on&mldr;</p></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></main></body></html>