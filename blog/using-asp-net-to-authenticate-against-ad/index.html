<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.120.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Using ASP.NET to authenticate against AD &#183; Salman Quazi</title>
<meta name=description content><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/poole.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/syntax.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><style type=text/css>.sidebar-about h1{font-size:1.95rem;font-weight:400}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")</script></head><body class=theme-base-08><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://www.salmanq.com/><h1>Salman Quazi</h1></a><p class=lead>Director of Engineering for Microsoft Azure OpenAI in Mountain View, CA.</p></div><nav><ul class=sidebar-nav><li><a href=https://www.salmanq.com/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=https://github.com/splusq/>Github</a></li><li><a href=https://www.linkedin.com/in/salmanquazi/>LinkedIn</a></li><li><a href=https://www.twitter.com/splusq>Twitter</a></li></ul></nav><p>Opinions are my own.</p></div></aside><main class="content container"><div class=post><h1>Using ASP.NET to authenticate against AD</h1><time datetime=2005-09-18T02:58:44Z class=post-date>Sun, Sep 18, 2005</time><p>The company I work for reliies heavily on active-directory to organize, authenticate and integrate. In order to login to the intranet from our site, we currently request the integrated windows authentication box and ask the user to login. For some people this was a little flattering because it didn&rsquo;t really say why the login was taking place &ndash; where are they loging into and so on. So to remedy this issue, I am working on a ASP.NET product that will authenticate against AD. This can be done using DirectoryServices provided within the .NET framework.</p><p><strong>Create secure connection to Active Directory</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> DirectoryEntry GetDirectoryEntry() {
</span></span><span style=display:flex><span>	DirectoryEntry de = <span style=color:#66d9ef>new</span> DirectoryEntry();
</span></span><span style=display:flex><span>	de.Path = <span style=color:#e6db74>&#34;LDAP://192.168.1.1/CN=Users;DC=Yourdomain&#34;</span>;
</span></span><span style=display:flex><span>	de.AuthenticationType = AuthenticationTypes.Secure;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> de;
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p><strong>Set the culture and identity</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> SetCultureAndIdentity() {
</span></span><span style=display:flex><span>	AppDomain.CurrentDomain.SetPrincipalPolicy(PrincipalPolicy.WindowsPrincipal);
</span></span><span style=display:flex><span>	WindowsPrincipal principal = (WindowsPrincipal)Thread.CurrentPrincipal;
</span></span><span style=display:flex><span>	WindowsIdentity identity = (WindowsIdentity)principal.Identity;
</span></span><span style=display:flex><span>	System.Threading.Thread.CurrentThread.CurrentCulture = <span style=color:#66d9ef>new</span> CultureInfo(<span style=color:#e6db74>&#34;en-US&#34;</span>);
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p><strong>Validate if user exists</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>bool</span> UserExists(<span style=color:#66d9ef>string</span> UserName) {
</span></span><span style=display:flex><span>	DirectoryEntry de = ADHelper.GetDirectoryEntry();
</span></span><span style=display:flex><span>	DirectorySearcher deSearch = <span style=color:#66d9ef>new</span> DirectorySearcher();
</span></span><span style=display:flex><span>	deSearch.SearchRoot =de;
</span></span><span style=display:flex><span>	deSearch.Filter = <span style=color:#e6db74>&#34;(&amp;(objectClass=user) (cn=&#34;</span> + UserName +<span style=color:#e6db74>&#34;))&#34;</span>; 
</span></span><span style=display:flex><span>	SearchResultCollection results = deSearch.FindAll();
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span>(results.Count == <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>Code provided from <a href=http://www.c-sharpcorner.com/Code/2005/June/ADand.NET.asp>C-Sharp corner</a>.</p></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></main></body></html>