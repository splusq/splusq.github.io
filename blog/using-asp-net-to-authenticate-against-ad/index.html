<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Using ASP.NET to authenticate against AD | Salman Quazi</title>
<meta property="og:title" content="Using ASP.NET to authenticate against AD | Salman Quazi"><meta name=twitter:title content="Using ASP.NET to authenticate against AD | Salman Quazi"><meta itemprop=name content="Using ASP.NET to authenticate against AD | Salman Quazi"><meta name=application-name content="Using ASP.NET to authenticate against AD | Salman Quazi"><meta property="og:site_name" content="Salman Quazi"><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><meta property="og:locale" content="en-us"><meta name=language content="en-us"><link rel=alternate hreflang=en href=https://www.salmanq.com/blog/using-asp-net-to-authenticate-against-ad/ title><meta name=generator content="Hugo 0.136.2"><meta property="og:url" content="https://www.salmanq.com/blog/using-asp-net-to-authenticate-against-ad/"><meta property="og:site_name" content="Salman Quazi"><meta property="og:title" content="Using ASP.NET to authenticate against AD"><meta property="og:description" content="The company I work for reliies heavily on active-directory to organize, authenticate and integrate. In order to login to the intranet from our site, we currently request the integrated windows authentication box and ask the user to login. For some people this was a little flattering because it didn’t really say why the login was taking place – where are they loging into and so on. So to remedy this issue, I am working on a ASP.NET product that will authenticate against AD. This can be done using DirectoryServices provided within the .NET framework."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2005-09-18T02:58:44+00:00"><meta property="article:modified_time" content="2005-09-18T02:58:44+00:00"><meta property="article:tag" content="Uncategorized"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using ASP.NET to authenticate against AD"><meta name=twitter:description content="The company I work for reliies heavily on active-directory to organize, authenticate and integrate. In order to login to the intranet from our site, we currently request the integrated windows authentication box and ask the user to login. For some people this was a little flattering because it didn’t really say why the login was taking place – where are they loging into and so on. So to remedy this issue, I am working on a ASP.NET product that will authenticate against AD. This can be done using DirectoryServices provided within the .NET framework."><link rel=canonical href=https://www.salmanq.com/blog/using-asp-net-to-authenticate-against-ad/><link href=/style.min.e390ba7da26222f4dc42a349955d76dbbe44e5ce2535a43de5a70633a0a9ec3c.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://www.salmanq.com/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")}</script></head><body data-theme=dark class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://www.salmanq.com/ class=logo><svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title/><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
</a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/blog/>Blog</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Using ASP.NET to authenticate against AD</h1><div class=post-meta><time datetime=2005-09-18T02:58:44+00:00 itemprop=datePublished>Sep 18, 2005</time></div></header><div class=page-content><p>The company I work for reliies heavily on active-directory to organize, authenticate and integrate. In order to login to the intranet from our site, we currently request the integrated windows authentication box and ask the user to login. For some people this was a little flattering because it didn&rsquo;t really say why the login was taking place &ndash; where are they loging into and so on. So to remedy this issue, I am working on a ASP.NET product that will authenticate against AD. This can be done using DirectoryServices provided within the .NET framework.</p><p><strong>Create secure connection to Active Directory</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl> <span class=kd>public</span> <span class=kd>static</span> <span class=n>DirectoryEntry</span> <span class=n>GetDirectoryEntry</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>DirectoryEntry</span> <span class=n>de</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DirectoryEntry</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>de</span><span class=p>.</span><span class=n>Path</span> <span class=p>=</span> <span class=s>&#34;LDAP://192.168.1.1/CN=Users;DC=Yourdomain&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>de</span><span class=p>.</span><span class=n>AuthenticationType</span> <span class=p>=</span> <span class=n>AuthenticationTypes</span><span class=p>.</span><span class=n>Secure</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>de</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><p><strong>Set the culture and identity</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl> <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>SetCultureAndIdentity</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>AppDomain</span><span class=p>.</span><span class=n>CurrentDomain</span><span class=p>.</span><span class=n>SetPrincipalPolicy</span><span class=p>(</span><span class=n>PrincipalPolicy</span><span class=p>.</span><span class=n>WindowsPrincipal</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>WindowsPrincipal</span> <span class=n>principal</span> <span class=p>=</span> <span class=p>(</span><span class=n>WindowsPrincipal</span><span class=p>)</span><span class=n>Thread</span><span class=p>.</span><span class=n>CurrentPrincipal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>WindowsIdentity</span> <span class=n>identity</span> <span class=p>=</span> <span class=p>(</span><span class=n>WindowsIdentity</span><span class=p>)</span><span class=n>principal</span><span class=p>.</span><span class=n>Identity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>System</span><span class=p>.</span><span class=n>Threading</span><span class=p>.</span><span class=n>Thread</span><span class=p>.</span><span class=n>CurrentThread</span><span class=p>.</span><span class=n>CurrentCulture</span> <span class=p>=</span> <span class=k>new</span> <span class=n>CultureInfo</span><span class=p>(</span><span class=s>&#34;en-US&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><p><strong>Validate if user exists</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl> <span class=kd>public</span> <span class=kt>bool</span> <span class=n>UserExists</span><span class=p>(</span><span class=kt>string</span> <span class=n>UserName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>DirectoryEntry</span> <span class=n>de</span> <span class=p>=</span> <span class=n>ADHelper</span><span class=p>.</span><span class=n>GetDirectoryEntry</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>DirectorySearcher</span> <span class=n>deSearch</span> <span class=p>=</span> <span class=k>new</span> <span class=n>DirectorySearcher</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=n>deSearch</span><span class=p>.</span><span class=n>SearchRoot</span> <span class=p>=</span><span class=n>de</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>deSearch</span><span class=p>.</span><span class=n>Filter</span> <span class=p>=</span> <span class=s>&#34;(&amp;(objectClass=user) (cn=&#34;</span> <span class=p>+</span> <span class=n>UserName</span> <span class=p>+</span><span class=s>&#34;))&#34;</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>	<span class=n>SearchResultCollection</span> <span class=n>results</span> <span class=p>=</span> <span class=n>deSearch</span><span class=p>.</span><span class=n>FindAll</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=n>results</span><span class=p>.</span><span class=n>Count</span> <span class=p>==</span> <span class=m>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></div><p>Code provided from <a href=http://www.c-sharpcorner.com/Code/2005/June/ADand.NET.asp>C-Sharp corner</a>.</p></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/splusq target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://www.twitter.com/splusq target=_blank rel="noopener noreferrer me" title=Twitter><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a><a href=https://www.linkedin.com/in/salmanquazi/ target=_blank rel="noopener noreferrer me" title=Linkedin><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2024 Salman Quazi.</small></footer><script src=https://www.salmanq.com/js/main.min.4ee188e1744c19816e95a540b2650ed9f033ea0371e74eac8e717355cfca8741.js integrity="sha256-TuGI4XRMGYFulaVAsmUO2fAz6gNx506sjnFzVc/Kh0E="></script></body></html>