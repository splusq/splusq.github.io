<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.120.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Using the MVVM pattern on web applications – Part III &#183; Salman Quazi</title>
<meta name=description content><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/poole.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/syntax.css><link type=text/css rel=stylesheet href=https://www.salmanq.com/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><style type=text/css>.sidebar-about h1{font-size:1.95rem;font-weight:400}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-K4WVH5P91F"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K4WVH5P91F")</script></head><body class=theme-base-08><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://www.salmanq.com/><h1>Salman Quazi</h1></a><p class=lead>Director of Engineering for Microsoft Azure OpenAI in Mountain View, CA.</p></div><nav><ul class=sidebar-nav><li><a href=https://www.salmanq.com/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=https://github.com/splusq/>Github</a></li><li><a href=https://www.linkedin.com/in/salmanquazi/>LinkedIn</a></li><li><a href=https://www.twitter.com/splusq>Twitter</a></li></ul></nav><p>Opinions are my own.</p></div></aside><main class="content container"><div class=post><h1>Using the MVVM pattern on web applications – Part III</h1><time datetime=2013-03-06T06:39:59Z class=post-date>Wed, Mar 6, 2013</time><p>We are at the finale of this three part series. <a href=/blog/using-the-mvvm-pattern-on-web-applications-part-i/>In part I</a> we discussed the MVVM design pattern, <a href=/blog/using-the-mvvm-pattern-on-web-applications-part-ii/>in part II</a> we looked at the overall architecture and how the server side fits into the picture. In this article we are going to look at the client side of this and close with some final thoughts. The best place to start with the client is the HTML - so here&rsquo;s the part of the HTML that&rsquo;s interesting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>tbody</span> <span style=color:#a6e22e>data-bind</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;foreach: Node&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>tr</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>td</span> <span style=color:#a6e22e>data-bind</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text: Name&#34;</span>&gt;&lt;/<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>td</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-align:right;font-weight:bold;&#34;</span> <span style=color:#a6e22e>data-bind</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text: Memory&#34;</span>&gt;&lt;/<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>tr</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>tbody</span>&gt; 
</span></span></code></pre></div><p>Notice that we are able to use a &ldquo;data binding&rdquo; like syntax similar to what we have seen in XAML using <a href=http://knockoutjs.com/>Knockout</a>. Basically we are binding a list of &ldquo;node&rdquo; elements as a row, and for-each row we want to bind the Name and Memory properties. What&rsquo;s really great about this is that the names of the properties came directly <a href=/blog/using-the-mvvm-pattern-on-web-applications-part-ii/>from the server model</a>. But how do we light this up? Meaning, how do we attach this page to the server side ViewModel? We do that using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>$</span>(document).<span style=color:#a6e22e>ready</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>dataContext</span>(<span style=color:#e6db74>&#34;Service.ViewModels.TaskViewModel&#34;</span>);
</span></span><span style=display:flex><span>}); 
</span></span></code></pre></div><p>Recall in part II, <a href=/blog/using-the-mvvm-pattern-on-web-applications-part-ii/>we exposed a MVC Web API to create the ViewModel</a> - which accepted the name of the ViewModel we wanted to create. So in JavaScript we created a dataContext object that talks to this API endpoint and hooks the websocket communication. That&rsquo;s all. Let&rsquo;s take a look at that too now:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span> <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dataContext</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vm</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>self</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>init</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>       
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>$</span>.<span style=color:#a6e22e>getJSON</span>(<span style=color:#e6db74>&#34;/Service/Api/Attach/&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vm</span>, <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>connectSocketServer</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>self</span>.<span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>update</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>d</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>init</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ko</span>.<span style=color:#a6e22e>mapping</span>.<span style=color:#a6e22e>fromJSON</span>(<span style=color:#a6e22e>d</span>, {}, <span style=color:#a6e22e>self</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ko</span>.<span style=color:#a6e22e>applyBindings</span>(<span style=color:#a6e22e>self</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>init</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ko</span>.<span style=color:#a6e22e>mapping</span>.<span style=color:#a6e22e>fromJSON</span>(<span style=color:#a6e22e>d</span>, {}, <span style=color:#a6e22e>self</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}; 
</span></span></code></pre></div><p>There you have it. Notice the getJSON call to have the server create the ViewModel for us, once that happens we use the websocket to communicate to the client and Knockout to apply the Binding. I hope you enjoyed this series and learned a few things. You can <a href=/2013/03/HtmlMagic.zip>download the full working source code</a> - you&rsquo;re welcome to modify this and use it as you see fit. One thing I do want to mention though - this was written pre .NET 4.5, when Websocket was not part of the .NET BCL - so this source code uses <a href=http://superwebsocket.codeplex.com/>SuperWebsocket</a>. However, now that there is native support for Websocket the code should be refactored.</p><ul><li><a href=/blog/using-the-mvvm-pattern-on-web-applications-part-i/>Using the MVVM pattern on web applications – Part I</a></li><li><a href=/blog/using-the-mvvm-pattern-on-web-applications-part-ii/>Using the MVVM pattern on web applications – Part II</a></li><li>Using the MVVM pattern on web applications – Part III</li></ul></div><h2>Comments</h2><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></main></body></html>