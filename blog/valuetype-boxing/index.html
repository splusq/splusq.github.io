<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ValueType Boxing | Salman Quazi</title><meta name=keywords content="Uncategorized"><meta name=description content="In .NET an interesting phehomenon occurs known as &ldquo;boxing&rdquo;. Let me illustrate the problem and then we will look at the possible solutions:
using System; using System.Collections; class Test { struct BankAccount { /* A simple BankAccount structure */ public float Balance; /* Balance in the account */ public BankAccount(float _Balance) { /* overloaded-contructor */ Balance = _Balance; } /* A method to charge the account */ public void ChargeAccount(float Fee) { Balance-=Fee; } } public static void Main() { ArrayList Accounts = new ArrayList(); /* An array */ Accounts."><meta name=author content="Me"><link rel=canonical href=https://www.salmanq.com/blog/valuetype-boxing/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.salmanq.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.salmanq.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.salmanq.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.salmanq.com/apple-touch-icon.png><link rel=mask-icon href=https://www.salmanq.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-38742121-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="ValueType Boxing"><meta property="og:description" content="In .NET an interesting phehomenon occurs known as &ldquo;boxing&rdquo;. Let me illustrate the problem and then we will look at the possible solutions:
using System; using System.Collections; class Test { struct BankAccount { /* A simple BankAccount structure */ public float Balance; /* Balance in the account */ public BankAccount(float _Balance) { /* overloaded-contructor */ Balance = _Balance; } /* A method to charge the account */ public void ChargeAccount(float Fee) { Balance-=Fee; } } public static void Main() { ArrayList Accounts = new ArrayList(); /* An array */ Accounts."><meta property="og:type" content="article"><meta property="og:url" content="https://www.salmanq.com/blog/valuetype-boxing/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2005-03-08T00:49:21+00:00"><meta property="article:modified_time" content="2005-03-08T00:49:21+00:00"><meta property="og:site_name" content="Salman Quazi"><meta name=twitter:card content="summary"><meta name=twitter:title content="ValueType Boxing"><meta name=twitter:description content="In .NET an interesting phehomenon occurs known as &ldquo;boxing&rdquo;. Let me illustrate the problem and then we will look at the possible solutions:
using System; using System.Collections; class Test { struct BankAccount { /* A simple BankAccount structure */ public float Balance; /* Balance in the account */ public BankAccount(float _Balance) { /* overloaded-contructor */ Balance = _Balance; } /* A method to charge the account */ public void ChargeAccount(float Fee) { Balance-=Fee; } } public static void Main() { ArrayList Accounts = new ArrayList(); /* An array */ Accounts."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://www.salmanq.com/blog/"},{"@type":"ListItem","position":2,"name":"ValueType Boxing","item":"https://www.salmanq.com/blog/valuetype-boxing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ValueType Boxing","name":"ValueType Boxing","description":"In .NET an interesting phehomenon occurs known as \u0026ldquo;boxing\u0026rdquo;. Let me illustrate the problem and then we will look at the possible solutions:\nusing System; using System.Collections; class Test { struct BankAccount { /* A simple BankAccount structure */ public float Balance; /* Balance in the account */ public BankAccount(float _Balance) { /* overloaded-contructor */ Balance = _Balance; } /* A method to charge the account */ public void ChargeAccount(float Fee) { Balance-=Fee; } } public static void Main() { ArrayList Accounts = new ArrayList(); /* An array */ Accounts.","keywords":["Uncategorized"],"articleBody":"In .NET an interesting phehomenon occurs known as “boxing”. Let me illustrate the problem and then we will look at the possible solutions:\nusing System; using System.Collections; class Test { struct BankAccount { /* A simple BankAccount structure */ public float Balance; /* Balance in the account */ public BankAccount(float _Balance) { /* overloaded-contructor */ Balance = _Balance; } /* A method to charge the account */ public void ChargeAccount(float Fee) { Balance-=Fee; } } public static void Main() { ArrayList Accounts = new ArrayList(); /* An array */ Accounts.Add(new BankAccount(100)); Accounts.Add(new BankAccount(200)); Accounts.Add(new BankAccount(300)); /* Line: 21 */ /* Go through each account and ChargeAccount 5.0 */ foreach(BankAccount Account in Accounts) { Account.ChargeAccount((float)5.0); Console.WriteLine(\"Boxed: \" + Account.Balance); } /* Go through each account and print the balance */ foreach(BankAccount Account in Accounts) { Console.WriteLine(\"Un-boxed: \" + Account.Balance); } } } The program outputs the following:\nBoxed: 95 Boxed: 195 Boxed: 295 Un-boxed: 100 Un-boxed: 200 Un-boxed: 300 Although you would most likely expect (or at least want) to get the following output:\nBoxed: 95 Boxed: 195 Boxed: 295 Un-boxed: 95 Un-boxed: 195 Un-boxed: 295 So what happened? If you look at line 21, we assumed that Account was a reference copy to Accounts which it isn’t. Account actually is a value-type (copied) value for each Accounts. And that’s why when you do a Account.ChargeAccount the copied Account is charged and therefore you see the change only in the first foreach loop. In the second foreach loop you once again start referring to the original Accounts values which was 100,200,300 respectively.\nTo solve the problem you have to reference the actual object when doing ChargeAccount, something similar to this:\nusing System; using System.Collections; class Test { struct BankAccount { public float Balance; public BankAccount(float _Balance) { Balance = _Balance; } public void ChargeAccount(float Fee) { Balance-=Fee; } } public static void Main() { BankAccount[] Accounts = new BankAccount[3]; Accounts[0] = new BankAccount(100); Accounts[1] = new BankAccount(200); Accounts[2] = new BankAccount(300); for(int i=0;i","wordCount":"387","inLanguage":"en","datePublished":"2005-03-08T00:49:21Z","dateModified":"2005-03-08T00:49:21Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.salmanq.com/blog/valuetype-boxing/"},"publisher":{"@type":"Organization","name":"Salman Quazi","logo":{"@type":"ImageObject","url":"https://www.salmanq.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.salmanq.com/ accesskey=h title="Salman Quazi (Alt + H)">Salman Quazi</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.salmanq.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://github.com/splusq/ title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.linkedin.com/in/salmanquazi/ title=LinkedIn><span>LinkedIn</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://www.twitter.com/splusq title=Twitter><span>Twitter</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.salmanq.com/>Home</a>&nbsp;»&nbsp;<a href=https://www.salmanq.com/blog/>Blogs</a></div><h1 class=post-title>ValueType Boxing</h1><div class=post-meta><span title='2005-03-08 00:49:21 +0000 UTC'>March 8, 2005</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Me</div></header><div class=post-content><p>In .NET an interesting phehomenon occurs known as &ldquo;boxing&rdquo;. Let me illustrate the problem and then we will look at the possible solutions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> System;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Collections;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>BankAccount</span> { <span style=color:#75715e>/* A simple BankAccount structure */</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>float</span> Balance; <span style=color:#75715e>/* Balance in the account */</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> BankAccount(<span style=color:#66d9ef>float</span> _Balance) { <span style=color:#75715e>/* overloaded-contructor */</span>
</span></span><span style=display:flex><span>			Balance = _Balance;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#75715e>/* A method to charge the account */</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ChargeAccount(<span style=color:#66d9ef>float</span> Fee) { 
</span></span><span style=display:flex><span>			Balance-=Fee;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main() {
</span></span><span style=display:flex><span>		ArrayList Accounts = <span style=color:#66d9ef>new</span> ArrayList(); <span style=color:#75715e>/* An array */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		Accounts.Add(<span style=color:#66d9ef>new</span> BankAccount(<span style=color:#ae81ff>100</span>)); 
</span></span><span style=display:flex><span>		Accounts.Add(<span style=color:#66d9ef>new</span> BankAccount(<span style=color:#ae81ff>200</span>)); 	  
</span></span><span style=display:flex><span>		Accounts.Add(<span style=color:#66d9ef>new</span> BankAccount(<span style=color:#ae81ff>300</span>)); 	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>/* Line: 21 */</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>/* Go through each account and ChargeAccount 5.0 */</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>foreach</span>(BankAccount Account <span style=color:#66d9ef>in</span> Accounts) {
</span></span><span style=display:flex><span>			Account.ChargeAccount((<span style=color:#66d9ef>float</span>)<span style=color:#ae81ff>5.0</span>);
</span></span><span style=display:flex><span>			Console.WriteLine(<span style=color:#e6db74>&#34;Boxed: &#34;</span> + Account.Balance);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>/* Go through each account and print the balance */</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>foreach</span>(BankAccount Account <span style=color:#66d9ef>in</span> Accounts) {
</span></span><span style=display:flex><span>			Console.WriteLine(<span style=color:#e6db74>&#34;Un-boxed: &#34;</span> + Account.Balance);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>The program outputs the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Boxed: <span style=color:#ae81ff>95</span>
</span></span><span style=display:flex><span>Boxed: <span style=color:#ae81ff>195</span>
</span></span><span style=display:flex><span>Boxed: <span style=color:#ae81ff>295</span>
</span></span><span style=display:flex><span>Un-boxed: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>Un-boxed: <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>Un-boxed: <span style=color:#ae81ff>300</span> 
</span></span></code></pre></div><p>Although you would most likely expect (or at least want) to get the following output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Boxed: <span style=color:#ae81ff>95</span>
</span></span><span style=display:flex><span>Boxed: <span style=color:#ae81ff>195</span>
</span></span><span style=display:flex><span>Boxed: <span style=color:#ae81ff>295</span>
</span></span><span style=display:flex><span>Un-boxed: <span style=color:#ae81ff>95</span>
</span></span><span style=display:flex><span>Un-boxed: <span style=color:#ae81ff>195</span>
</span></span><span style=display:flex><span>Un-boxed: <span style=color:#ae81ff>295</span> 
</span></span></code></pre></div><p>So what happened? If you look at line 21, we assumed that Account was a reference copy to Accounts which it isn&rsquo;t. Account actually is a value-type (copied) value for each Accounts. And that&rsquo;s why when you do a Account.ChargeAccount the copied Account is charged and therefore you see the change only in the first foreach loop. In the second foreach loop you once again start referring to the original Accounts values which was 100,200,300 respectively.</p><p>To solve the problem you have to reference the actual object when doing ChargeAccount, something similar to this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> System;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Collections;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>BankAccount</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>float</span> Balance;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> BankAccount(<span style=color:#66d9ef>float</span> _Balance) {
</span></span><span style=display:flex><span>			Balance = _Balance;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ChargeAccount(<span style=color:#66d9ef>float</span> Fee) {
</span></span><span style=display:flex><span>			Balance-=Fee;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main() {
</span></span><span style=display:flex><span>		BankAccount[] Accounts = <span style=color:#66d9ef>new</span> BankAccount[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>		Accounts[<span style=color:#ae81ff>0</span>] = <span style=color:#66d9ef>new</span> BankAccount(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>		Accounts[<span style=color:#ae81ff>1</span>] = <span style=color:#66d9ef>new</span> BankAccount(<span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>		Accounts[<span style=color:#ae81ff>2</span>] = <span style=color:#66d9ef>new</span> BankAccount(<span style=color:#ae81ff>300</span>);
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i=<span style=color:#ae81ff>0</span>;i&lt;accounts.Length;++i) {
</span></span><span style=display:flex><span>			Accounts[i].ChargeAccount((<span style=color:#66d9ef>float</span>)<span style=color:#ae81ff>5.0</span>);
</span></span><span style=display:flex><span>			Console.WriteLine(<span style=color:#e6db74>&#34;Boxed: &#34;</span> + Accounts[i].Balance);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>int</span> i=<span style=color:#ae81ff>0</span>;i&lt;accounts.Length;++i) {
</span></span><span style=display:flex><span>			Console.WriteLine(<span style=color:#e6db74>&#34;Un-Boxed: &#34;</span> + Accounts[i].Balance);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>} 
</span></span></code></pre></div><p>Notice however, this requires you to give a size of the array prior to using the array. This might be an inconvenience and there is a way to solve that problem also. We&rsquo;ll look into that next time.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.salmanq.com/tags/uncategorized/>Uncategorized</a></li></ul><nav class=paginav><a class=prev href=https://www.salmanq.com/blog/mysql-version-information/><span class=title>« Prev</span><br><span>MySQL version information</span></a>
<a class=next href=https://www.salmanq.com/blog/uncertaintly-principal-and-software-engineering/><span class=title>Next »</span><br><span>Uncertaintly Principal and Software Engineering</span></a></nav></footer><script src=https://utteranc.es/client.js repo=splusq/splusq.github.io issue-term=title theme=github-dark crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.salmanq.com/>Salman Quazi</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>